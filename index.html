<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>작가용 작업 플래너</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      @media print { .no-print { display: none !important; } }
    </style>
  </head>
  <body>
 

<style>
   /* 🌙 다크모드 전체 배경 및 텍스트 */
  .dark {
    --tw-bg-opacity: 1;
    background-color: rgb(17 24 39 / var(--tw-bg-opacity)); /* gray-900 */
    color: #f3f4f6; /* gray-100 */
  }

  /* 🌙 다크모드 바깥 여백(사이드 포함) */
  .dark body {
    background-color: #0f172a !important; /* gray-950 */
    color: #f3f4f6;
  }


  /* ☀️ 라이트모드 기본 */
  body:not(.dark) {
    background-color: #f9fafb; /* gray-50 */
    color: #111827; /* gray-900 */
  }

  /* 🌙 다크모드 카드톤 (gray-850 느낌) */
  .bg-gray-850 {
    background-color: #1e293b;
  }

  /* 🌙 다크모드 그래프/캔버스 영역 */
  .dark canvas,
  .dark .chart-container,
  .dark .recharts-wrapper,
  .dark .graph-area {
    background-color: #1e293b !important; /* gray-850 */
    color: #e5e7eb !important;
    border-radius: 0.5rem;
  }

  /* 🌙 다크모드 input/select/date 색상 */
  .dark input,
  .dark select,
  .dark textarea {
    background-color: #374151 !important; /* gray-700 */
    color: #f3f4f6 !important;
    border-color: #4b5563 !important;
  }

  .dark input::placeholder,
  .dark textarea::placeholder {
    color: #9ca3af !important; /* gray-400 */
  }

  /* 🌙 다크모드 date-picker와 전후 버튼 */
  .dark input[type="date"] {
    background-color: #374151 !important;
    color: #f3f4f6 !important;
    border: 1px solid #4b5563 !important;
    border-radius: 0.5rem;
    padding: 0.5rem 1rem;
  }

  .dark input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(1) brightness(1.2);
  }

  .dark button.bg-gray-200 {
    background-color: #4b5563 !important; /* gray-600 */
    color: #e5e7eb !important;
    border: 1px solid #6b7280 !important;
  }

  .dark button.bg-gray-200:hover {
    background-color: #6b7280 !important; /* gray-500 */
  }

  /* 🌙 캘린더 셀 색상 */
  .dark .calendar-day {
    background-color: #1f2937 !important; /* gray-800 */
    color: #e5e7eb !important;
    border: 1px solid #374151 !important;
  }
  .dark .calendar-day.active {
    background-color: #4338ca !important; /* indigo-700 */
    color: #ffffff !important;
  }
  .dark .calendar-day.empty {
    background-color: transparent !important;
    border: none !important;
  }

/* 🌙 다크모드에서 글자색을 그래프색(밝은 파랑/보라)으로 통일 */
.dark h1, 
.dark h2, 
.dark h3, 
.dark h4, 
.dark h5, 
.dark h6,
.dark .text-gray-900,
.dark .text-gray-800,
.dark .text-gray-700,
.dark .text-gray-600 {
  color: #818CF8 !important; /* Tailwind indigo-400 */
}

/* 설명 텍스트나 서브 텍스트는 조금 연하게 */
.dark .text-gray-500,
.dark .text-gray-400 {
  color: #A5B4FC !important; /* Tailwind indigo-300 */
}
/* 🌙 다크모드 카드 제목 강조 */
.dark .font-medium,
.dark .font-semibold,
.dark h3 {
  color: #A5B4FC !important; /* Tailwind indigo-300 */
}

/* 카드 안의 작품명 전용 */
.dark .text-indigo-700,
.dark h3.text-indigo-700,
.dark span.text-indigo-700 {
  color: #C7D2FE !important; /* Tailwind indigo-200 정도로 더 밝게 */
  font-weight: 600;
}

/* 카드 hover 시 좀 더 부드럽게 밝아지게 */
.dark .hover\:text-indigo-400:hover {
  color: #818CF8 !important; /* Tailwind indigo-400 */
}
/* 🌙 다크모드 — 누적 통계 섹션 제목 색상 */
.dark h2.text-lg,
.dark h3.text-md,
.dark h2.font-semibold,
.dark h3.font-semibold,
.dark h2.text-indigo-700,
.dark h3.text-indigo-700 {
  color: #A5B4FC !important; /* Tailwind indigo-300 */
  font-weight: 600;
}

/* 🌙 누적 통계의 아이콘 텍스트(📘, 📆 등 포함)도 통일 */
.dark h2,
.dark h3 {
  color: #C7D2FE !important; /* Tailwind indigo-200 */
}

/* 🌙 섹션 소제목 (예: '이번 달 누적', '올해 누적') 살짝 부드럽게 */
.dark .text-indigo-700 {
  color: #A5B4FC !important; /* 부드러운 파스텔톤 보라색 */
}
/* 🌙 다크모드 — 누적 통계 리스트 내 작품명 색상 밝게 */
.dark ul li span.text-indigo-600,
.dark ul li span:first-child {
  color: #A5B4FC !important; /* indigo-300 — 밝은 보라 */
  font-weight: 500;
}

/* 🌙 다크모드 — 통계 리스트 숫자 부분은 조금 덜 밝게 */
.dark ul li span:last-child {
  color: #E5E7EB !important; /* gray-200 — 숫자는 은은하게 */
}
/* 🌙 다크모드 - 작품별 평균 작성 속도 & 최고 생산일 카드 내부 텍스트 밝게 */
.dark .p-3.border.rounded-lg {
  color: #E0E7FF !important; /* text-indigo-100 밝은 청보라 */
}

.dark .p-3.border.rounded-lg .text-gray-500,
.dark .p-3.border.rounded-lg .text-gray-600 {
  color: #C7D2FE !important; /* text-indigo-200 — 라벨용 */
}

.dark .p-3.border.rounded-lg .font-bold.text-indigo-600,
.dark .p-3.border.rounded-lg .text-indigo-600 {
  color: #A5B4FC !important; /* text-indigo-300 — 주요 수치 */
}

.dark .p-3.border.rounded-lg .text-gray-700 {
  color: #E5E7EB !important; /* text-gray-200 — 일반 텍스트 */
}

.dark .p-3.border.rounded-lg .text-gray-400 {
  color: #CBD5E1 !important; /* text-gray-300 — 보조 설명 */
}

</style>



    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;

      const PROJECTS = [
        "낫카피",
        "술 끊겠습니다",
        "그 공작이 내 구원이 될 리 없잖아",
        "임시 각인 가이드",
        "초단편",
        "이 꽃의 주인은 누구?",
        "기타"
      ];

      const fmtDate = (d) => {
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        return `${y}-${m}-${day}`;
      };

      const emptyProject = () => ({
        startTime: "",
        startWords: 0,
        logs: [],
      });

      const emptyDay = () => ({});

function parseKoreanTime(str) {
  const match = str.match(/(오전|오후)\s(\d+):(\d+)/);
  if (!match) return 0;
  let [, ampm, hh, mm] = match;
  hh = parseInt(hh, 10);
  mm = parseInt(mm, 10);
  if (ampm === "오후" && hh !== 12) hh += 12;
  if (ampm === "오전" && hh === 12) hh = 0;
  return hh * 60 + mm; // 분 단위
}


      function PlannerApp() {
const [darkMode, setDarkMode] = useState(false);

// ✅ 다크모드 불러오기
useEffect(() => {
  const saved = localStorage.getItem("darkMode");
  if (saved) setDarkMode(saved === "true");
}, []);

// ✅ 다크모드 저장
useEffect(() => {
  localStorage.setItem("darkMode", darkMode);
  if (darkMode) {
    document.documentElement.classList.add("dark");
  } else {
    document.documentElement.classList.remove("dark");
  }
}, [darkMode]);

        const [tab, setTab] = useState("log");
        const [dateStr, setDateStr] = useState(fmtDate(new Date()));
        const [store, setStore] = useState({});
        const [filterProject, setFilterProject] = useState(PROJECTS[0]);
      


        // 🧩 데이터 불러오기
        useEffect(() => {
          const raw = localStorage.getItem("writer_planner_store_v4");
          if (raw) {
            try {
              setStore(JSON.parse(raw));
            } catch (e) {
              console.error("불러오기 실패:", e);
            }
          }
        }, []);

        // 💾 저장
        useEffect(() => {
          localStorage.setItem("writer_planner_store_v4", JSON.stringify(store));
        }, [store]);

        // ✅ 날짜별/작품별 데이터 접근
        const day = store[dateStr] ?? emptyDay();
        const setDay = (upd) =>
          setStore((prev) => ({
            ...prev,
            [dateStr]:
              typeof upd === "function"
                ? upd(prev[dateStr] ?? emptyDay())
                : upd,
          }));

        const projectData = day[filterProject] ?? emptyProject();
        const setProjectData = (upd) => {
          setDay((cur) => {
            const copy = JSON.parse(JSON.stringify(cur ?? emptyDay()));
            copy[filterProject] =
              typeof upd === "function"
                ? upd(copy[filterProject] ?? emptyProject())
                : upd;
            return copy;
          });
        };

        // 🔁 날짜 전환
        const nextDay = (delta) => {
          const d = new Date(dateStr);
          d.setDate(d.getDate() + delta);
          setDateStr(fmtDate(d));
        };

        // 🧱 로그 추가
        const addLog = (currentWords) => {
          setProjectData((cur) => {
            const data = JSON.parse(JSON.stringify(cur ?? emptyProject()));
            const logs = data.logs || [];
            const base =
              logs.length > 0
                ? logs[logs.length - 1].currentWords
                : data.startWords || 0;
            const diff = Math.max(0, currentWords - base);
            logs.push({
              time: new Date().toLocaleTimeString("ko-KR", {
                hour: "2-digit",
                minute: "2-digit",
              }),
              currentWords,
              diff,
            });
            data.logs = logs;
            return data;
          });
        };

        // ❌ 로그 삭제
        const removeLog = (idx) => {
          setProjectData((cur) => {
            const data = JSON.parse(JSON.stringify(cur ?? emptyProject()));
            data.logs.splice(idx, 1);
            return data;
          });
        };

        // 📊 통계 계산
        const totalWords = Object.values(day).reduce(
  (sum, proj) =>
    sum + ((proj.logs || []).reduce((s, l) => s + (l.diff || 0), 0)),
  0
);

// 🔧 프로젝트별 통계 계산 함수 (임시 버전)
function getProjectStats(proj) {
  const projData = day[proj] || emptyProject();
const logs = projData.logs || [];
const total = logs.reduce((s, l) => s + (l.diff || 0), 0);

  const sessions = logs.length;
  const avg = sessions > 0 ? Math.round(total / sessions) : 0;

  // 🕒 누적 시간 계산 (세션 1개 = 0.5시간 가정)
  const hours = sessions * 0.5;

  return {
  total,
  sessions,
  avg,
  hours,
  startTime: projData.startTime || "--:--",
  startCount: projData.startWords || 0,
  goal: 5000,
};

}


// 🔧 프로젝트 상세 열기 (임시)
function openProjectDetail(proj) {
  alert(`${proj} 상세 보기 (추후 구현 예정)`);
}

// 🎬 작품 상세 모달
const [activeProject, setActiveProject] = useState(null);

const ProjectModal = ({ proj, onClose }) => {
  const dayData = store[dateStr]?.[proj] || {};
  const logs = dayData.logs || [];
  const total = logs.reduce((sum, l) => sum + (l.diff || 0), 0);
  const sessions = logs.length;
  const avg = sessions > 0 ? Math.round(total / sessions) : 0;

  const [memo, setMemo] = useState(dayData.memo || "");

  const saveMemo = () => {
    setStore((prev) => {
      const copy = JSON.parse(JSON.stringify(prev));
      if (!copy[dateStr]) copy[dateStr] = {};
      if (!copy[dateStr][proj]) copy[dateStr][proj] = {};
      copy[dateStr][proj].memo = memo;
      return copy;
    });
  };

  return (
    
  <div
    className="fixed inset-0 bg-black/40 flex items-center justify-center z-50"
    onClick={onClose} // 배경 클릭 시 닫힘
  >
    <div
      className={`${darkMode ? "bg-gray-800 text-gray-400 border-gray-600" : "bg-white text-gray-900 border-gray-300"} p-4 rounded-lg relative`}
      onClick={(e) => e.stopPropagation()} // 내부 클릭은 닫히지 않음
    >
      <button
        onClick={onClose}
        className="absolute top-3 right-3 text-gray-500 hover:text-gray-800"
      >
        ✕
      </button>


        <h2 className="text-xl font-bold text-indigo-600 mb-4">{proj}</h2>

        {/* 요약 */}
        <div className="grid grid-cols-3 gap-2 text-center mb-4">
          <div>
            <div className="text-sm text-gray-500">총합</div>
            <div className="font-semibold text-indigo-600">
              {total.toLocaleString()}자
            </div>
          </div>
          <div>
            <div className="text-sm text-gray-500">세션</div>
            <div className="font-semibold">{sessions}</div>
          </div>
          <div>
            <div className="text-sm text-gray-500">평균</div>
            <div className="font-semibold">
              {avg.toLocaleString()}자
            </div>
          </div>
        

      {/* 🧩 로그 목록 */}
{(projectData.logs ?? []).length === 0 ? (
  <div className="text-gray-500 text-sm">기록 없음</div>
) : (
[...(projectData.logs ?? [])]
  .sort((a, b) => parseKoreanTime(b.time) - parseKoreanTime(a.time)) // 최신순
  .map((l, i) => (

    <div key={`${l.time}-${l.currentWords}`} className="flex justify-between items-center bg-gray-50 p-2 mb-1 rounded-lg">
      <span>{l.time}</span>
      <span>{l.diff.toLocaleString()}자</span>
      <button
        onClick={() => removeLog(projectData.logs.findIndex(x => x.time === l.time && x.currentWords === l.currentWords))}
        className="text-xs text-red-500"
      >
        삭제
      </button>
    </div>
  ))
)}


        </div>
{/* 📅 최근 7일 기록 요약 */}
<div className="mb-4">
  <h3 className="text-sm font-semibold text-indigo-700 mb-2">📅 최근 7일 집필 기록</h3>
  <div className="bg-gray-50 rounded-lg p-3 text-sm">
    {(() => {
      const today = new Date(dateStr);
      const last7 = [];
      for (let i = 6; i >= 0; i--) {
        const d = new Date(today);
        d.setDate(today.getDate() - i);
        const key = fmtDate(d);
        const logs = store[key]?.[proj]?.logs || [];
        const total = logs.reduce((s, l) => s + (l.diff || 0), 0);
        if (total > 0) last7.push({ date: key.slice(5), total });
      }

      if (last7.length === 0)
        return <p className="text-gray-400 text-xs">최근 7일간 기록이 없습니다.</p>;

      return (
        <div className="space-y-1">
          {last7.map((d, i) => (
            <div
              key={i}
              className="flex justify-between border-b border-dashed border-gray-200 last:border-none"
            >
              <span>{d.date}</span>
              <span className="text-indigo-600">{d.total.toLocaleString()}자</span>
            </div>
          ))}
        </div>
      );
    })()}
  </div>
</div>

{/* 📊 누적 요약 */}
<div className="border-t border-gray-200 pt-3 mb-4 text-sm">
  {(() => {
    const allDays = Object.entries(store);
    let total = 0;
    let sessions = 0;
    allDays.forEach(([_, data]) => {
      const logs = data[proj]?.logs || [];
      total += logs.reduce((s, l) => s + (l.diff || 0), 0);
      sessions += logs.length;
    });
    const avg = sessions > 0 ? Math.round(total / sessions) : 0;

    return (
      <div className="grid grid-cols-3 text-center text-gray-700">
        <div>
          <div className="text-gray-500 text-xs">누적 총합</div>
          <div className="font-semibold text-indigo-600">{total.toLocaleString()}자</div>
        </div>
        <div>
          <div className="text-gray-500 text-xs">세션 수</div>
          <div className="font-semibold">{sessions}</div>
        </div>
        <div>
          <div className="text-gray-500 text-xs">평균</div>
          <div className="font-semibold">{avg.toLocaleString()}자</div>
        </div>
      </div>
    );
  })()}
</div>

        {/* 메모 */}
        <div>
          <textarea
            value={memo}
            onChange={(e) => setMemo(e.target.value)}
            className="w-full border rounded-lg p-2 text-sm h-20"
            placeholder="오늘의 작업 소감이나 메모를 적어보세요"
          />
          <button
            onClick={saveMemo}
            className="mt-2 px-4 py-2 bg-indigo-500 text-white rounded-lg text-sm"
          >
            💾 메모 저장
          </button>
        </div>
      </div>
    </div>
  );
};

        return (
          <div
  className={`max-w-4xl mx-auto p-6 transition-colors duration-300 ${
  darkMode ? "bg-gray-900 text-gray-300" : "bg-gray-50 text-gray-900"
}`}
>

            <h1 className="text-2xl sm:text-3xl font-bold mb-6">작가용 작업 플래너</h1>
<div className="flex justify-end mb-4">
  <button
    onClick={() => setDarkMode(!darkMode)}
    className={`px-4 py-2 rounded-lg transition ${
      darkMode
        ? "bg-gray-700 hover:bg-gray-600 text-yellow-300"
        : "bg-white hover:bg-gray-100 text-gray-700 border"
    }`}
  >
    {darkMode ? "☀️ 라이트모드" : "🌙 다크모드"}
  </button>
</div>


           

            {/* 🔸 날짜 선택 */}
            <div className="flex items-center gap-2 mb-4">
              <button
                onClick={() => nextDay(-1)}
                className="px-3 py-1 bg-gray-200 rounded-lg"
              >
                ◀
              </button>
              <input
                type="date"
                value={dateStr}
                onChange={(e) => setDateStr(e.target.value)}
                className="border rounded-lg p-2"
              />
              <button
                onClick={() => nextDay(1)}
                className="px-3 py-1 bg-gray-200 rounded-lg"
              >
                ▶
              </button>
            </div>

            {/* 🔸 작품 선택 */}
            <div className="mb-4">
              <select
                value={filterProject}
                onChange={(e) => setFilterProject(e.target.value)}
                className="p-2 border rounded-lg"
              >
                {PROJECTS.map((p) => (
                  <option key={p}>{p}</option>
                ))}
              </select>
            </div>

            {/* 🌅 작품별 시작 정보 */}
            <div className={`${darkMode ? "bg-gray-850 text-gray-200 border border-gray-700" : "bg-indigo-50 text-gray-900 border border-gray-200"} p-4 rounded-lg mb-4`}>

              <h3 className="font-semibold mb-2 text-indigo-700">
                🌅 {filterProject} 시작 정보
              </h3>

              <div className="flex gap-4 mb-2 items-center">
                <label className="text-sm w-24">시작 시간</label>
                <input
                  type="time"
                  value={projectData.startTime || ""}
                  onChange={(e) =>
                    setProjectData((cur) => ({
                      ...cur,
                      startTime: e.target.value,
                    }))
                  }
                  className="p-2 border rounded-lg w-40"
                />
              </div>

              <div className="flex gap-4 items-center">
                <label className="text-sm w-24">시작 글자수</label>
                <input
                  type="number"
                  value={projectData.startWords || ""}
                  onChange={(e) =>
                    setProjectData((cur) => ({
                      ...cur,
                      startWords: Number(e.target.value) || 0,
                    }))
                  }
                  className="p-2 border rounded-lg w-40"
                />
              </div>
            </div>

            {/* 🧱 로그 입력 */}
            <div className="flex gap-2 mb-4">
              <input
                id="currentWords"
                type="number"
                placeholder="현재 글자수"
                className="p-2 border rounded-lg w-32"
              />
              <button
                onClick={() => {
                  const cur = Number(
                    document.getElementById("currentWords").value || 0
                  );
                  if (cur <= 0) return alert("현재 글자수를 입력하세요!");
                  addLog(cur);
                  document.getElementById("currentWords").value = "";
                }}
                className="px-4 py-2 bg-indigo-500 text-white rounded-lg"
              >
                + 기록
              </button>
            </div>

           {/* 🧩 로그 목록 */}
{(projectData.logs ?? []).length === 0 ? (
  <div className="text-gray-500 text-sm">기록 없음</div>
) : (
[...(projectData.logs ?? [])]
  .sort((a, b) => parseKoreanTime(b.time) - parseKoreanTime(a.time)) // 최신순
  .map((l, i) => (
      <div
  key={i}
  className={`flex justify-between items-center p-2 mb-1 rounded-lg ${
    darkMode
      ? "bg-gray-800 text-gray-200 border border-gray-700"
      : "bg-gray-50 text-gray-900 border border-gray-200"
  }`}
>

        <span>{l.time}</span>
        <span>{l.diff.toLocaleString()}자</span>
        <button
          onClick={() => removeLog(i)}
          className="text-xs text-red-500"
        >
          삭제
        </button>
      </div>
    ))
)}



            <div className="mt-3 text-right font-semibold text-indigo-600">
              총합: {totalWords.toLocaleString()}자
            </div>

{/* 📊 작품별 요약 통계 */}
<div className={`${darkMode 
  ? "bg-gray-850 text-gray-200 border-gray-700" 
  : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}>


  <h2 className="font-semibold text-lg mb-4">📊 오늘의 작품별 요약</h2>

  {(() => {
    const today = store[dateStr] || {};
    const projectSummaries = Object.entries(today).map(([proj, data]) => {
      const logs = data.logs || [];
      const total = logs.reduce((sum, l) => sum + (l.diff || 0), 0);
      const sessions = logs.length;
      const avg = sessions > 0 ? Math.round(total / sessions) : 0;
      return { proj, total, sessions, avg };
    });

    const grandTotal = projectSummaries.reduce((s, p) => s + p.total, 0);

    if (projectSummaries.length === 0) {
      return <p className="text-gray-500 text-sm">오늘 기록된 작품이 없습니다.</p>;
    }

    return (
      <>
        {/* 전체 총합 */}
        <div className={`flex justify-between items-center mb-4 p-3 rounded-lg ${
  darkMode ? "bg-gray-800 text-gray-200 border border-gray-700" : "bg-indigo-50 text-gray-900 border border-gray-200"
}`}>

          <span className="font-semibold text-indigo-700">전체 합계</span>
          <span className="font-bold text-indigo-600 text-lg">
            {grandTotal.toLocaleString()}자
          </span>
        </div>

        {/* 작품별 표 */}
        <table className="w-full border-collapse mb-6 text-sm">
          <thead>
            <tr className="bg-gray-100 text-gray-700">
              <th className="border p-2 text-left">작품명</th>
              <th className="border p-2">세션 수</th>
              <th className="border p-2">총합</th>
              <th className="border p-2">평균</th>
            </tr>
          </thead>
          <tbody>
            {projectSummaries.map((p) => (
              <tr key={p.proj} className="hover:bg-gray-50">
                <td className="border p-2 text-indigo-600 font-medium">{p.proj}</td>
                <td className="border p-2 text-center">{p.sessions}</td>
                <td className="border p-2 text-center text-indigo-700">
                  {p.total.toLocaleString()}자
                </td>
                <td className="border p-2 text-center text-gray-700">
                  {p.avg.toLocaleString()}자
                </td>
              </tr>
            ))}
          </tbody>
        </table>

        {/* 그래프 */}
        <h3 className="font-semibold mb-2 text-gray-700">📈 시각화</h3>
        <div className={`graph-area flex items-end gap-2 h-48 p-4 rounded-lg overflow-x-auto ${
  darkMode ? "text-gray-200" : "text-gray-900"
}`}>


          {projectSummaries.map((p) => {
            const maxValue = Math.max(...projectSummaries.map((x) => x.total), 1);
            const height = (p.total / maxValue) * 160;
            return (
              <div key={p.proj} className="flex flex-col items-center justify-end flex-1">
                <div
                  className="bg-indigo-500 rounded-t w-6"
                  style={{ height: `${height}px` }}
                ></div>
                <span className="text-xs mt-2 text-center break-keep">{p.proj}</span>
              </div>
            );
          })}
        </div>
      </>
    );
  })()}
</div>
{/* 📅 월간 / 연간 누적 통계 */}
<div className={`${darkMode 
  ? "bg-gray-850 text-gray-200 border-gray-700" 
  : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}>



  <h2 className="font-semibold text-lg mb-4">📅 월간 · 연간 누적 통계</h2>

  {(() => {
    const now = new Date(dateStr);
    const year = now.getFullYear();
    const month = now.getMonth();

    // 월간 누적
    const monthlyTotals = {};
    Object.entries(store).forEach(([day, data]) => {
      const d = new Date(day);
      if (d.getFullYear() === year && d.getMonth() === month) {
        Object.entries(data || {}).forEach(([proj, val]) => {
          if (!val.logs) return;
          const total = val.logs.reduce((s, l) => s + (l.diff || 0), 0);
          monthlyTotals[proj] = (monthlyTotals[proj] || 0) + total;
        });
      }
    });

    // 연간 누적
    const yearlyTotals = {};
    Object.entries(store).forEach(([day, data]) => {
      const d = new Date(day);
      if (d.getFullYear() === year) {
        Object.entries(data || {}).forEach(([proj, val]) => {
          if (!val.logs) return;
          const total = val.logs.reduce((s, l) => s + (l.diff || 0), 0);
          yearlyTotals[proj] = (yearlyTotals[proj] || 0) + total;
        });
      }
    });

    const monthlySorted = Object.entries(monthlyTotals).sort((a, b) => b[1] - a[1]);
    const yearlySorted = Object.entries(yearlyTotals).sort((a, b) => b[1] - a[1]);

    const maxMonth = Math.max(...monthlySorted.map(([_, v]) => v), 1);
    const maxYear = Math.max(...yearlySorted.map(([_, v]) => v), 1);

    return (
      <>
        {/* 월간 요약 */}
        <div className="mb-8">
          <h3 className="font-semibold mb-2 text-indigo-700">📆 이번 달 누적</h3>
          {monthlySorted.length === 0 ? (
            <p className="text-gray-500 text-sm">이번 달 작성 기록이 없습니다.</p>
          ) : (
            <>
              <ul className="text-sm mb-4">
                {monthlySorted.map(([proj, val]) => (
                  <li key={proj} className="flex justify-between border-b py-1">
                    <span className="text-indigo-600">{proj}</span>
                    <span>{val.toLocaleString()}자</span>
                  </li>
                ))}
              </ul>
              <div className={`flex items-end gap-2 h-40 p-3 rounded-lg overflow-x-auto ${
  darkMode ? "bg-gray-800 text-gray-200" : "bg-gray-50 text-gray-900"
}`}>

                {monthlySorted.map(([proj, val]) => (
                  <div key={proj} className="flex flex-col items-center justify-end flex-1">
                    <div
                      className="bg-indigo-400 rounded-t w-6"
                      style={{ height: `${(val / maxMonth) * 150}px` }}
                    ></div>
                    <span className="text-xs mt-2 text-center break-keep">{proj}</span>
                  </div>
                ))}
              </div>
            </>
          )}
        </div>

        {/* 연간 요약 */}
        <div>
          <h3 className="font-semibold mb-2 text-indigo-700">📘 올해 누적</h3>
          {yearlySorted.length === 0 ? (
            <p className="text-gray-500 text-sm">올해 작성 기록이 없습니다.</p>
          ) : (
            <>
              <ul className="text-sm mb-4">
                {yearlySorted.map(([proj, val]) => (
                  <li key={proj} className="flex justify-between border-b py-1">
                    <span className="text-indigo-600">{proj}</span>
                    <span>{val.toLocaleString()}자</span>
                  </li>
                ))}
              </ul>
              <div className="graph-area flex items-end gap-2 h-48 p-3 rounded-lg overflow-x-auto">
                {yearlySorted.map(([proj, val]) => (
                  <div key={proj} className="flex flex-col items-center justify-end flex-1">
                    <div
                      className="bg-indigo-500 rounded-t w-6"
                      style={{ height: `${(val / maxYear) * 160}px` }}
                    ></div>
                    <span className="text-xs mt-2 text-center break-keep">{proj}</span>
                  </div>
                ))}
              </div>
            </>
          )}
        </div>
      </>
    );
  })()}
</div>
{/* 🎯 작품별 목표 대비 진행률 */}
<div className={`${darkMode 
  ? "bg-gray-850 text-gray-200 border-gray-700" 
  : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}>



  <h2 className="font-semibold text-lg mb-4">🎯 작품별 목표 진행률</h2>

  {(() => {
    // 목표 불러오기
    const raw = localStorage.getItem("writer_targets");
    const targets = raw ? JSON.parse(raw) : {};

    // 목표 수정
    const updateTarget = (proj, val) => {
      const updated = { ...targets, [proj]: val };
      localStorage.setItem("writer_targets", JSON.stringify(updated));
      alert(`${proj} 목표가 ${val.toLocaleString()}자로 설정되었습니다.`);
    };

    // 각 작품별 총합
    const projectTotals = {};
    Object.entries(store).forEach(([_, data]) => {
      Object.entries(data || {}).forEach(([proj, val]) => {
        if (!val.logs) return;
        const total = val.logs.reduce((s, l) => s + (l.diff || 0), 0);
        projectTotals[proj] = (projectTotals[proj] || 0) + total;
      });
    });

    const entries = Object.entries(projectTotals).sort((a, b) => b[1] - a[1]);

    if (entries.length === 0) {
      return <p className="text-gray-500 text-sm">기록된 작품이 없습니다.</p>;
    }

    return (
      <div className="space-y-4">
        {entries.map(([proj, total]) => {
          const goal = targets[proj] || 0;
          const progress = goal > 0 ? Math.min(100, (total / goal) * 100) : 0;
          const barColor =
            progress >= 100
              ? "bg-green-500"
              : progress >= 70
              ? "bg-indigo-500"
              : "bg-gray-300";

          return (
            <div key={proj} className="p-3 border rounded-lg">
              <div className="flex justify-between items-center mb-2">
                <span className="font-medium text-indigo-700">{proj}</span>
                <span className="text-sm text-gray-600">
                  {goal > 0 ? `${progress.toFixed(1)}%` : "목표 미설정"}
                </span>
              </div>

              {/* 진행률 바 */}
              <div className="w-full bg-gray-200 h-3 rounded-full overflow-hidden mb-2">
                <div
                  className={`${barColor} h-3 transition-all duration-300`}
                  style={{ width: `${progress}%` }}
                ></div>
              </div>

              {/* 목표 입력 */}
              <div className="flex items-center gap-2">
                <input
                  type="number"
                  placeholder="목표 글자수"
                  defaultValue={goal || ""}
                  className="p-1 border rounded-lg w-32 text-sm"
                  id={`goal-${proj}`}
                />
                <button
                  className="px-3 py-1 text-xs bg-indigo-500 text-white rounded-lg"
                  onClick={() => {
                    const val = Number(document.getElementById(`goal-${proj}`).value || 0);
                    updateTarget(proj, val);
                  }}
                >
                  저장
                </button>
              </div>

              {/* 현재 총합 */}
              <div className="text-xs text-gray-500 mt-1">
                현재 {total.toLocaleString()}자 / 목표{" "}
                {goal > 0 ? goal.toLocaleString() : "미설정"}
              </div>
            </div>
          );
        })}
      </div>
    );
  })()}
</div>
{/* 📅 작품별 평균 작성 속도 & 최고 생산일 */}
<div className={`${darkMode 
  ? "bg-gray-850 text-gray-200 border-gray-700" 
  : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}>



  <h2 className="font-semibold text-lg mb-4">📅 작품별 평균 작성 속도 & 최고 생산일</h2>

  {(() => {
    const projectStats = {};

    // store를 순회하며 작품별 총합, 일수, 최고 생산일 계산
    Object.entries(store).forEach(([date, data]) => {
      Object.entries(data || {}).forEach(([proj, val]) => {
        if (!val.logs) return;
        const total = val.logs.reduce((s, l) => s + (l.diff || 0), 0);

        if (!projectStats[proj]) {
          projectStats[proj] = {
            total: 0,
            days: 0,
            daily: {},
            maxDay: "",
            maxAmount: 0,
          };
        }

        projectStats[proj].total += total;
        projectStats[proj].days += 1;
        projectStats[proj].daily[date] = total;

        // 최고 생산일 갱신
        if (total > projectStats[proj].maxAmount) {
          projectStats[proj].maxAmount = total;
          projectStats[proj].maxDay = date;
        }
      });
    });

    const entries = Object.entries(projectStats).sort(
      (a, b) => b[1].total - a[1].total
    );

    if (entries.length === 0) {
      return <p className="text-gray-500 text-sm">기록된 작품이 없습니다.</p>;
    }

    return (
      <div className="space-y-4">
        {entries.map(([proj, info]) => {
          const avgDaily = info.days ? Math.round(info.total / info.days) : 0;

          // 월평균 계산
          const months = new Set(
            Object.keys(info.daily).map((d) => {
              const [y, m] = d.split("-").map(Number);
              return `${y}-${m}`;
            })
          );
          const avgMonthly = months.size
            ? Math.round(info.total / months.size)
            : info.total;

          return (
            <div key={proj} className="p-3 border rounded-lg">
              <div className="flex justify-between items-center mb-2">
                <span className="font-medium text-indigo-700">{proj}</span>
                <span className="text-sm text-gray-600">
                  총 {info.total.toLocaleString()}자
                </span>
              </div>

              <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 text-center text-sm">
                <div className={`${darkMode ? "bg-gray-850 text-gray-200 border border-gray-700" : "bg-indigo-50 text-gray-900 border border-gray-200"} p-4 rounded-lg mb-4`}>

                  <div className="text-gray-500">일평균</div>
                  <div className="font-bold text-indigo-600">
                    {avgDaily.toLocaleString()}자
                  </div>
                </div>
                <div className={`${darkMode ? "bg-gray-850 text-gray-200 border border-gray-700" : "bg-indigo-50 text-gray-900 border border-gray-200"} p-4 rounded-lg mb-4`}>

                  <div className="text-gray-500">월평균</div>
                  <div className="font-bold text-indigo-600">
                    {avgMonthly.toLocaleString()}자
                  </div>
                </div>
                <div className={`${darkMode ? "bg-gray-850 text-gray-200 border border-gray-700" : "bg-indigo-50 text-gray-900 border border-gray-200"} p-4 rounded-lg mb-4`}>

                  <div className="text-gray-500">최고 생산일</div>
                  <div className="font-bold text-indigo-600">
                    {info.maxDay || "-"}
                  </div>
                </div>
              </div>
            </div>
          );
        })}
      </div>
    );
  })()}
</div>
{/* 🔥 오늘의 집필 랭킹 & 목표 달성률 */}
<div className={`${darkMode 
  ? "bg-gray-850 text-gray-200 border-gray-700" 
  : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}>



  <h2 className="font-semibold text-lg mb-4">🔥 오늘의 집필 랭킹 & 목표 달성률</h2>

  {(() => {
    const today = store[dateStr] || {};
    const entries = Object.entries(today).filter(([k]) => k !== "logs" && k !== "startTime" && k !== "startWords");

    if (entries.length === 0) {
      return <p className="text-gray-500 text-sm">오늘 작성된 작품이 없습니다.</p>;
    }

    const projectRank = entries
      .map(([proj, val]) => {
        const total = (val.logs || []).reduce((s, l) => s + (l.diff || 0), 0);
        const goal = val.goal || 5000; // 기본 목표 5천자
        const progress = Math.min(100, (total / goal) * 100);
        return { proj, total, goal, progress };
      })
      .sort((a, b) => b.total - a.total);

    return (
      <div className="space-y-3">
        {projectRank.map((p, idx) => (
          <div key={p.proj} className={`p-3 border rounded-lg ${
  darkMode ? "bg-gray-850 text-gray-200 border-gray-700" : "bg-gray-50 text-gray-900 border-gray-200"
}`}>

            <div className="flex justify-between items-center mb-2">
              <div className="flex items-center gap-2">
                <span className="font-medium text-indigo-700">{p.proj}</span>
                {idx === 0 && <span className="text-red-500 text-lg">🔥</span>}
              </div>
              <span className="text-sm text-gray-600">{p.total.toLocaleString()}자</span>
            </div>

            {/* 진행률 바 */}
            <div className="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
              <div
                className={`h-3 rounded-full ${
                  p.progress >= 100 ? "bg-green-500" : "bg-indigo-500"
                }`}
                style={{ width: `${p.progress}%` }}
              ></div>
            </div>

            {/* 목표량 및 달성률 표시 */}
            <div className="flex justify-between text-xs text-gray-500 mt-1">
              <span>목표: {p.goal.toLocaleString()}자</span>
              <span>달성률: {p.progress.toFixed(1)}%</span>
            </div>

            {/* 목표량 변경 */}
            <div className="flex gap-2 mt-2 items-center">
              <input
                type="number"
                placeholder="목표량 수정"
                defaultValue={p.goal}
                className="w-24 p-1 text-sm border rounded"
                onBlur={(e) => {
                  const newGoal = Number(e.target.value || 0);
                  if (newGoal > 0) {
                    setDay((cur) => {
                      const n = JSON.parse(JSON.stringify(cur ?? emptyDay()));
                      if (!n[p.proj]) n[p.proj] = { logs: [] };
                      n[p.proj].goal = newGoal;
                      return n;
                    });
                  }
                }}
              />
              <span className="text-xs text-gray-400">(엔터 없이 포커스 아웃 시 저장)</span>
            </div>
          </div>
        ))}
      </div>
    );
  })()}
</div>

{/* 📅 주간 & 월간 트렌드 대시보드 */}
<div className={`${darkMode 
  ? "bg-gray-850 text-gray-200 border-gray-700" 
  : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}>



  <h2 className="font-semibold text-lg mb-4">📅 주간 & 월간 트렌드</h2>

  {(() => {
    const today = new Date(dateStr);
    const past7Days = [];
    for (let i = 6; i >= 0; i--) {
      const d = new Date(today);
      d.setDate(today.getDate() - i);
      const key = fmtDate(d);
      const data = store[key] || {};
      let total = 0;
      Object.values(data).forEach((proj) => {
        if (proj?.logs) total += proj.logs.reduce((s, l) => s + (l.diff || 0), 0);
      });
      past7Days.push({ date: key, total });
    }

    const maxWeekly = Math.max(...past7Days.map((d) => d.total), 1);
    const avgWeekly = past7Days.reduce((a, b) => a + b.total, 0) / 7;

    // 🗓 월간 데이터 계산
    const currentYear = today.getFullYear();
    const currentMonth = today.getMonth();
    const monthData = {};

    Object.entries(store).forEach(([key, val]) => {
      const d = new Date(key);
      if (d.getFullYear() === currentYear && d.getMonth() === currentMonth) {
        const week = Math.ceil(d.getDate() / 7); // 1~4주차 분류
        let total = 0;
        Object.values(val).forEach((proj) => {
          if (proj?.logs) total += proj.logs.reduce((s, l) => s + (l.diff || 0), 0);
        });
        monthData[week] = (monthData[week] || 0) + total;
      }
    });

    const monthWeeks = Object.keys(monthData).sort();
    const maxMonthly = Math.max(...Object.values(monthData), 1);

    return (
      <div className="space-y-8">

        {/* 📆 주간 트렌드 */}
        <section>
          <h3 className="font-semibold text-md mb-2 text-indigo-700">📆 최근 7일간 집필 추이</h3>
          <div className={`flex items-end gap-2 h-40 rounded-lg p-2 overflow-x-auto ${
  darkMode ? "bg-gray-800 text-gray-200" : "bg-gray-50 text-gray-900"
}`}>

            {past7Days.map((d, i) => (
              <div key={i} className="flex flex-col items-center justify-end flex-1 min-w-[28px]">
                <div
                  className="bg-indigo-400 rounded-t"
                  style={{ height: `${(d.total / maxWeekly) * 120}px`, width: "18px" }}
                ></div>
                <span className="text-[10px] text-gray-500 mt-1">
                  {d.date.slice(5)}
                </span>
              </div>
            ))}
          </div>
          <div className="text-sm text-gray-600 mt-3">
            📈 일평균: <b>{Math.round(avgWeekly).toLocaleString()}자</b>,  
            최고: <b>{Math.max(...past7Days.map((d) => d.total)).toLocaleString()}자</b>
          </div>
        </section>

        {/* 🗓 월간 트렌드 */}
        <section>
          <h3 className="font-semibold text-md mb-2 text-indigo-700">🗓 이번 달 주차별 평균</h3>
          <div className={`graph-area flex items-end gap-2 h-48 p-4 rounded-lg overflow-x-auto ${
  darkMode ? "text-gray-200" : "text-gray-900"
}`}>

            {monthWeeks.length === 0 && (
              <p className="text-gray-500 text-sm m-auto">이번 달 작성 기록이 없습니다.</p>
            )}
            {monthWeeks.map((w) => (
              <div key={w} className="flex flex-col items-center justify-end flex-1">
                <div
                  className="bg-indigo-500 rounded-t"
                  style={{ height: `${(monthData[w] / maxMonthly) * 160}px`, width: "28px" }}
                ></div>
                <span className="text-xs text-gray-500 mt-1">{w}주차</span>
              </div>
            ))}
          </div>
        </section>

      </div>
    );
  })()}
</div>
{/* 🗓 월간 집필 캘린더 */}
<div className={`${darkMode 
  ? "bg-gray-850 text-gray-200 border-gray-700" 
  : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}>



  <h2 className="font-semibold text-lg mb-4">🗓 월간 집필 캘린더</h2>

  {(() => {
    const today = new Date(dateStr);
    const year = today.getFullYear();
    const month = today.getMonth(); // 0~11

    // 월 첫째 날 요일 계산
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    // 🧮 일자별 총합 계산
    const monthData = {};
    Object.entries(store).forEach(([date, data]) => {
      const d = new Date(date);
      if (d.getFullYear() === year && d.getMonth() === month) {
        const total = Object.values(data || {}).reduce((sum, proj) => {
          if (!proj?.logs) return sum;
          return sum + proj.logs.reduce((s, l) => s + (l.diff || 0), 0);
        }, 0);
        monthData[d.getDate()] = total;
      }
    });

    // 🎨 색상 결정 함수
    const getColor = (value) => {
      if (!value || value === 0) return "bg-gray-100 text-gray-400";
      if (value < 3000) return "bg-indigo-100 text-gray-700";
      if (value < 6000) return "bg-indigo-300 text-white";
      if (value < 9000) return "bg-green-300 text-white";
      return "bg-green-500 text-white";
    };

    // 📊 월간 요약 통계
    const total = Object.values(monthData).reduce((a, b) => a + b, 0);
    const daysWritten = Object.values(monthData).filter((v) => v > 0).length;
    const avg = daysWritten > 0 ? Math.round(total / daysWritten) : 0;
    const goal = 150000;
    const progress = Math.min(100, (total / goal) * 100);

    return (
      <div>
        {/* 월 변경 네비게이션 */}
        <div className="flex justify-between items-center mb-4">
          <button
            onClick={() => {
              const prev = new Date(year, month - 1, 1);
              setDateStr(fmtDate(prev));
            }}
            className="px-3 py-1 bg-gray-200 rounded-lg"
          >
            ◀ 이전 달
          </button>

          <h3 className="text-lg font-semibold text-indigo-700">
            {year}년 {month + 1}월
          </h3>

          <button
            onClick={() => {
              const next = new Date(year, month + 1, 1);
              setDateStr(fmtDate(next));
            }}
            className="px-3 py-1 bg-gray-200 rounded-lg"
          >
            다음 달 ▶
          </button>
        </div>

        {/* 🧱 캘린더 */}
        <div className="grid grid-cols-7 text-center text-sm font-medium mb-2 text-gray-600">
          <div>일</div>
          <div>월</div>
          <div>화</div>
          <div>수</div>
          <div>목</div>
          <div>금</div>
          <div>토</div>
        </div>

        <div className="grid grid-cols-7 gap-2 text-center text-xs">
          {/* 공백 채우기 */}
          {Array.from({ length: firstDay }).map((_, i) => (
            <div key={`empty-${i}`} className="h-20"></div>
          ))}

          {/* 날짜별 셀 */}
          {Array.from({ length: daysInMonth }).map((_, i) => {
            const day = i + 1;
            const value = monthData[day] || 0;
            const color = getColor(value);
            return (
              <div
  key={day}
  className={`calendar-day flex flex-col justify-between h-20 rounded-lg p-1 ${color} shadow-sm`}
>

                <div className="text-[11px] font-bold">{day}</div>
                <div className="text-[11px]">{value.toLocaleString()}자</div>
              </div>
            );
          })}
        </div>

        {/* 📈 월간 요약 */}
        <div className={`mt-6 p-4 rounded-lg text-sm ${
  darkMode ? "bg-gray-800 text-gray-200 border border-gray-700" : "bg-indigo-50 text-gray-900 border border-gray-200"
}`}>

          <div className="flex justify-between">
            <span>총합</span>
            <span className="font-semibold text-indigo-700">
              {total.toLocaleString()}자
            </span>
          </div>
          <div className="flex justify-between">
            <span>작성일 수</span>
            <span>{daysWritten}일</span>
          </div>
          <div className="flex justify-between">
            <span>일평균</span>
            <span>{avg.toLocaleString()}자</span>
          </div>
          <div className="flex justify-between">
            <span>목표 달성률</span>
            <span className="font-semibold text-green-600">
              {progress.toFixed(1)}%
            </span>
          </div>
        </div>
      </div>
    );
  })()}
</div>

{/* 🎨 작품별 요약 카드 */}
<div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
 {PROJECTS.map((proj) => {
  const stats = getProjectStats(proj); // 누적 통계 가져오기
  const progress = stats.goal > 0 ? Math.min((stats.total / stats.goal) * 100, 100) : 0;
  const remaining = stats.goal > 0 ? stats.goal - stats.total : 0;
  const avgSpeed = stats.hours > 0 ? (stats.total / stats.hours).toFixed(1) : 0;

  return (
   <div
  key={proj}
  onClick={() => setActiveProject(proj)}
  className={`${
    darkMode
      ? "bg-gray-800 text-gray-300 border-gray-600"
      : "bg-white text-gray-900 border-gray-300"
  } p-4 rounded-lg hover:shadow-md cursor-pointer transition`}
>

      <h3 className="text-lg font-semibold text-indigo-700 mb-2">{proj}</h3>
      <p className="text-sm text-gray-600 mb-2">시작 글자수: {stats.startCount || 0}</p>

      {/* 원형 진행률 바 */}
      <div className="flex items-center mb-2">
        <div className="relative w-10 h-10 mr-3">
          <svg className="w-10 h-10" viewBox="0 0 36 36">
            <path
              className="text-gray-200"
              strokeWidth="3.5"
              stroke="currentColor"
              fill="none"
              d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831
                 a 15.9155 15.9155 0 0 1 0 -31.831"
            />
            <path
              className="text-indigo-700"
              strokeWidth="3.5"
              strokeDasharray={`${progress}, 100`}
              strokeLinecap="round"
              fill="none"
              stroke="currentColor"
              d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831
                 a 15.9155 15.9155 0 0 1 0 -31.831"
            />
          </svg>
          <span className="absolute inset-0 flex items-center justify-center text-xs font-medium text-indigo-700">
            {progress.toFixed(0)}%
          </span>
        </div>

        <div>
          <p className="text-sm font-medium text-gray-800">총합: {stats.total}자</p>
          <p className="text-xs text-gray-500">남은 목표치: {remaining > 0 ? remaining : 0}자</p>
        </div>
      </div>

      <div className="text-xs text-gray-600 space-y-1">
        <p>세션: {stats.sessions}회</p>
        <p>누적 작업 시간: {stats.hours.toFixed(1)}시간</p>
        <p>평균 속도: {avgSpeed}자/시간</p>
      </div>
    </div>
  );
})}

{activeProject && (
  <ProjectModal
    proj={activeProject}
    onClose={() => setActiveProject(null)}
  />
)}

</div>

          </div>
        );
      }

  window.PlannerApp = PlannerApp;
    

    </script>
<!-- ⚡ Firebase 로그인 상태 확인 후 React 렌더링 -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDDaQFVkQMG63wI7guyMPygx9QwaokMu7I",
  authDomain: "writer-planner.firebaseapp.com",
  projectId: "writer-planner",
  storageBucket: "writer-planner.firebasestorage.app",
  messagingSenderId: "590639652717",
  appId: "1:590639652717:web:bc69fa99d82f6c5e760464"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

// 로그인 버튼
const loginButton = document.createElement("button");
loginButton.innerText = "🔑 Google 로그인";
loginButton.className = "fixed bottom-5 right-5 bg-indigo-500 text-white px-4 py-2 rounded-lg shadow";
document.body.appendChild(loginButton);

// 로그인
loginButton.onclick = () => signInWithPopup(auth, provider);

// 로그인 상태 감시
onAuthStateChanged(auth, async (user) => {
  if (user) {
    loginButton.innerText = `👋 ${user.displayName}님`;
    loginButton.disabled = true;

    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);

    if (snap.exists()) {
      const cloudData = snap.data();
      localStorage.setItem("writer_planner_store_v4", JSON.stringify(cloudData));
      console.log("☁️ 클라우드 데이터 불러옴");
    } else {
      console.log("신규 사용자 — 기본 데이터 저장");
      await setDoc(ref, {});
    }

    // 💾 자동 백업
    setInterval(async () => {
      const localData = JSON.parse(localStorage.getItem("writer_planner_store_v4") || "{}");
      await setDoc(ref, localData);
      console.log("✅ 클라우드 자동 백업 완료");
    }, 30000);

    // ✅ 로그인 후에만 React 앱 실행
    if (!window.reactStarted) {
      window.reactStarted = true;
     const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(React.createElement(window.PlannerApp));

    }
  } else {
    console.log("로그인 필요");
  }
});
</script>


  </body>
</html>

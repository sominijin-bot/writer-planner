<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ì‘ê°€ìš© ì‘ì—… í”Œë˜ë„ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      @media print { .no-print { display: none !important; } }
    </style>
  </head>
  <body>
 

<style>
   /* ğŸŒ™ ë‹¤í¬ëª¨ë“œ ì „ì²´ ë°°ê²½ ë° í…ìŠ¤íŠ¸ */
  .dark {
    --tw-bg-opacity: 1;
    background-color: rgb(17 24 39 / var(--tw-bg-opacity)); /* gray-900 */
    color: #f3f4f6; /* gray-100 */
  }

  /* ğŸŒ™ ë‹¤í¬ëª¨ë“œ ë°”ê¹¥ ì—¬ë°±(ì‚¬ì´ë“œ í¬í•¨) */
  .dark body {
    background-color: #0f172a !important; /* gray-950 */
    color: #f3f4f6;
  }


  /* â˜€ï¸ ë¼ì´íŠ¸ëª¨ë“œ ê¸°ë³¸ */
  body:not(.dark) {
    background-color: #f9fafb; /* gray-50 */
    color: #111827; /* gray-900 */
  }

  /* ğŸŒ™ ë‹¤í¬ëª¨ë“œ ì¹´ë“œí†¤ (gray-850 ëŠë‚Œ) */
  .bg-gray-850 {
    background-color: #1e293b;
  }

  /* ğŸŒ™ ë‹¤í¬ëª¨ë“œ ê·¸ë˜í”„/ìº”ë²„ìŠ¤ ì˜ì—­ */
  .dark canvas,
  .dark .chart-container,
  .dark .recharts-wrapper,
  .dark .graph-area {
    background-color: #1e293b !important; /* gray-850 */
    color: #e5e7eb !important;
    border-radius: 0.5rem;
  }

  /* ğŸŒ™ ë‹¤í¬ëª¨ë“œ input/select/date ìƒ‰ìƒ */
  .dark input,
  .dark select,
  .dark textarea {
    background-color: #374151 !important; /* gray-700 */
    color: #f3f4f6 !important;
    border-color: #4b5563 !important;
  }

  .dark input::placeholder,
  .dark textarea::placeholder {
    color: #9ca3af !important; /* gray-400 */
  }

  /* ğŸŒ™ ë‹¤í¬ëª¨ë“œ date-pickerì™€ ì „í›„ ë²„íŠ¼ */
  .dark input[type="date"] {
    background-color: #374151 !important;
    color: #f3f4f6 !important;
    border: 1px solid #4b5563 !important;
    border-radius: 0.5rem;
    padding: 0.5rem 1rem;
  }

  .dark input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(1) brightness(1.2);
  }

  .dark button.bg-gray-200 {
    background-color: #4b5563 !important; /* gray-600 */
    color: #e5e7eb !important;
    border: 1px solid #6b7280 !important;
  }

  .dark button.bg-gray-200:hover {
    background-color: #6b7280 !important; /* gray-500 */
  }

  /* ğŸŒ™ ìº˜ë¦°ë” ì…€ ìƒ‰ìƒ */
  .dark .calendar-day {
    background-color: #1f2937 !important; /* gray-800 */
    color: #e5e7eb !important;
    border: 1px solid #374151 !important;
  }
  .dark .calendar-day.active {
    background-color: #4338ca !important; /* indigo-700 */
    color: #ffffff !important;
  }
  .dark .calendar-day.empty {
    background-color: transparent !important;
    border: none !important;
  }

/* ğŸŒ™ ë‹¤í¬ëª¨ë“œì—ì„œ ê¸€ììƒ‰ì„ ê·¸ë˜í”„ìƒ‰(ë°ì€ íŒŒë‘/ë³´ë¼)ìœ¼ë¡œ í†µì¼ */
.dark h1, 
.dark h2, 
.dark h3, 
.dark h4, 
.dark h5, 
.dark h6,
.dark .text-gray-900,
.dark .text-gray-800,
.dark .text-gray-700,
.dark .text-gray-600 {
  color: #818CF8 !important; /* Tailwind indigo-400 */
}

/* ì„¤ëª… í…ìŠ¤íŠ¸ë‚˜ ì„œë¸Œ í…ìŠ¤íŠ¸ëŠ” ì¡°ê¸ˆ ì—°í•˜ê²Œ */
.dark .text-gray-500,
.dark .text-gray-400 {
  color: #A5B4FC !important; /* Tailwind indigo-300 */
}
/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ ì¹´ë“œ ì œëª© ê°•ì¡° */
.dark .font-medium,
.dark .font-semibold,
.dark h3 {
  color: #A5B4FC !important; /* Tailwind indigo-300 */
}

/* ì¹´ë“œ ì•ˆì˜ ì‘í’ˆëª… ì „ìš© */
.dark .text-indigo-700,
.dark h3.text-indigo-700,
.dark span.text-indigo-700 {
  color: #C7D2FE !important; /* Tailwind indigo-200 ì •ë„ë¡œ ë” ë°ê²Œ */
  font-weight: 600;
}

/* ì¹´ë“œ hover ì‹œ ì¢€ ë” ë¶€ë“œëŸ½ê²Œ ë°ì•„ì§€ê²Œ */
.dark .hover\:text-indigo-400:hover {
  color: #818CF8 !important; /* Tailwind indigo-400 */
}
/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ â€” ëˆ„ì  í†µê³„ ì„¹ì…˜ ì œëª© ìƒ‰ìƒ */
.dark h2.text-lg,
.dark h3.text-md,
.dark h2.font-semibold,
.dark h3.font-semibold,
.dark h2.text-indigo-700,
.dark h3.text-indigo-700 {
  color: #A5B4FC !important; /* Tailwind indigo-300 */
  font-weight: 600;
}

/* ğŸŒ™ ëˆ„ì  í†µê³„ì˜ ì•„ì´ì½˜ í…ìŠ¤íŠ¸(ğŸ“˜, ğŸ“† ë“± í¬í•¨)ë„ í†µì¼ */
.dark h2,
.dark h3 {
  color: #C7D2FE !important; /* Tailwind indigo-200 */
}

/* ğŸŒ™ ì„¹ì…˜ ì†Œì œëª© (ì˜ˆ: 'ì´ë²ˆ ë‹¬ ëˆ„ì ', 'ì˜¬í•´ ëˆ„ì ') ì‚´ì§ ë¶€ë“œëŸ½ê²Œ */
.dark .text-indigo-700 {
  color: #A5B4FC !important; /* ë¶€ë“œëŸ¬ìš´ íŒŒìŠ¤í…”í†¤ ë³´ë¼ìƒ‰ */
}
/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ â€” ëˆ„ì  í†µê³„ ë¦¬ìŠ¤íŠ¸ ë‚´ ì‘í’ˆëª… ìƒ‰ìƒ ë°ê²Œ */
.dark ul li span.text-indigo-600,
.dark ul li span:first-child {
  color: #A5B4FC !important; /* indigo-300 â€” ë°ì€ ë³´ë¼ */
  font-weight: 500;
}

/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ â€” í†µê³„ ë¦¬ìŠ¤íŠ¸ ìˆ«ì ë¶€ë¶„ì€ ì¡°ê¸ˆ ëœ ë°ê²Œ */
.dark ul li span:last-child {
  color: #E5E7EB !important; /* gray-200 â€” ìˆ«ìëŠ” ì€ì€í•˜ê²Œ */
}
/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ - ì‘í’ˆë³„ í‰ê·  ì‘ì„± ì†ë„ & ìµœê³  ìƒì‚°ì¼ ì¹´ë“œ ë‚´ë¶€ í…ìŠ¤íŠ¸ ë°ê²Œ */
.dark .p-3.border.rounded-lg {
  color: #E0E7FF !important; /* text-indigo-100 ë°ì€ ì²­ë³´ë¼ */
}

.dark .p-3.border.rounded-lg .text-gray-500,
.dark .p-3.border.rounded-lg .text-gray-600 {
  color: #C7D2FE !important; /* text-indigo-200 â€” ë¼ë²¨ìš© */
}

.dark .p-3.border.rounded-lg .font-bold.text-indigo-600,
.dark .p-3.border.rounded-lg .text-indigo-600 {
  color: #A5B4FC !important; /* text-indigo-300 â€” ì£¼ìš” ìˆ˜ì¹˜ */
}

.dark .p-3.border.rounded-lg .text-gray-700 {
  color: #E5E7EB !important; /* text-gray-200 â€” ì¼ë°˜ í…ìŠ¤íŠ¸ */
}

.dark .p-3.border.rounded-lg .text-gray-400 {
  color: #CBD5E1 !important; /* text-gray-300 â€” ë³´ì¡° ì„¤ëª… */
}

</style>



    <div id="root"></div>

    <script type="text/babel" data-presets="env,react">
      const { useState, useEffect, useMemo } = React;

      const PROJECTS = [
        "ë‚«ì¹´í”¼",
        "ìˆ  ëŠê² ìŠµë‹ˆë‹¤",
        "ê·¸ ê³µì‘ì´ ë‚´ êµ¬ì›ì´ ë  ë¦¬ ì—†ì–ì•„",
        "ì„ì‹œ ê°ì¸ ê°€ì´ë“œ",
        "ì´ˆë‹¨í¸",
        "ì´ ê½ƒì˜ ì£¼ì¸ì€ ëˆ„êµ¬?",
        "ê¸°íƒ€"
      ];

      const fmtDate = (d) => {
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        return `${y}-${m}-${day}`;
      };

      const emptyProject = () => ({
        startTime: "",
        startWords: 0,
        logs: [],
      });

      const emptyDay = () => ({});

function parseKoreanTime(str) {
  const match = str.match(/(ì˜¤ì „|ì˜¤í›„)\s(\d+):(\d+)/);
  if (!match) return 0;
  let [, ampm, hh, mm] = match;
  hh = parseInt(hh, 10);
  mm = parseInt(mm, 10);
  if (ampm === "ì˜¤í›„" && hh !== 12) hh += 12;
  if (ampm === "ì˜¤ì „" && hh === 12) hh = 0;
  return hh * 60 + mm; // ë¶„ ë‹¨ìœ„
}

function CalendarSection({ darkMode }) {
  const [tasks, setTasks] = React.useState(() => {
    return JSON.parse(localStorage.getItem("calendar_tasks") || "{}");
  });
  const [selectedDate, setSelectedDate] = React.useState(null);

  React.useEffect(() => {
    localStorage.setItem("calendar_tasks", JSON.stringify(tasks));
  }, [tasks]);

  const today = new Date();
  const year = today.getFullYear();
  const month = today.getMonth() + 1;
  const daysInMonth = new Date(year, month, 0).getDate();

  function handleDateClick(date) {
    setSelectedDate(date);
  }

  function handleAddTask() {
    const text = prompt(`${selectedDate} ì¼ì • ë‚´ìš© ì…ë ¥`);
    if (!text) return;
    setTasks((prev) => {
      const updated = { ...prev };
      if (!updated[selectedDate]) updated[selectedDate] = [];
      updated[selectedDate].push(text);
      return updated;
    });
  }

  function handleEditTask(idx) {
    const newText = prompt("ìˆ˜ì •í•  ë‚´ìš© ì…ë ¥", tasks[selectedDate][idx]);
    if (!newText) return;
    setTasks((prev) => {
      const updated = { ...prev };
      updated[selectedDate][idx] = newText;
      return updated;
    });
  }

  function handleDeleteTask(idx) {
    if (!confirm("ì •ë§ ì‚­ì œí• ê¹Œìš”?")) return;
    setTasks((prev) => {
      const updated = { ...prev };
      updated[selectedDate].splice(idx, 1);
      if (updated[selectedDate].length === 0) delete updated[selectedDate];
      return updated;
    });
  }

  return (
    <div
      className={`p-4 rounded-lg mb-6 ${
        darkMode
          ? "bg-gray-850 text-gray-200 border-gray-700"
          : "bg-white text-gray-900 border-gray-200"
      }`}
    >
      <h2 className="font-semibold text-lg mb-4">ğŸ“† ì¼ì • ê´€ë¦¬</h2>

      <div className="grid grid-cols-7 gap-2">
        {Array.from({ length: daysInMonth }, (_, i) => i + 1).map((d) => {
          const dateKey = `${year}-${String(month).padStart(2, "0")}-${String(d).padStart(2, "0")}`;
          const hasTask = tasks[dateKey]?.length > 0;
          return (
            <div
              key={d}
              onClick={() => handleDateClick(dateKey)}
              className={`p-3 text-center border rounded-lg cursor-pointer hover:bg-blue-100 dark:hover:bg-gray-700 ${
                hasTask ? "bg-indigo-100 dark:bg-indigo-800" : ""
              }`}
            >
              <div className="font-medium">{d}</div>
              {hasTask && (
                <div className="text-xs text-gray-600 dark:text-gray-300">
                  {tasks[dateKey].length}ê±´
                </div>
              )}
            </div>
          );
        })}
      </div>

      {selectedDate && (
        <div className="mt-6 p-4 rounded-lg bg-gray-50 dark:bg-gray-800">
          <div className="flex justify-between items-center mb-2">
            <h3 className="font-semibold">{selectedDate}</h3>
            <button
              className="bg-blue-500 text-white px-3 py-1 rounded"
              onClick={handleAddTask}
            >
              + ì¼ì • ì¶”ê°€
            </button>
          </div>

          {tasks[selectedDate]?.length > 0 ? (
            <ul className="space-y-1">
              {tasks[selectedDate].map((t, i) => (
                <li
                  key={i}
                  className="flex justify-between items-center bg-white dark:bg-gray-700 p-2 rounded shadow-sm"
                >
                  <span>{t}</span>
                  <div className="space-x-2">
                    <button
                      className="text-yellow-600 text-sm"
                      onClick={() => handleEditTask(i)}
                    >
                      ìˆ˜ì •
                    </button>
                    <button
                      className="text-red-600 text-sm"
                      onClick={() => handleDeleteTask(i)}
                    >
                      ì‚­ì œ
                    </button>
                  </div>
                </li>
              ))}
            </ul>
          ) : (
            <p className="text-sm text-gray-500">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          )}
        </div>
      )}
    </div>
  );
}

function ContractSection({ darkMode }) {
  const [contracts, setContracts] = React.useState(() => {
    const raw = localStorage.getItem("writer_contracts_v1");
    return raw ? JSON.parse(raw) : [];
  });

  const emptyContract = {
    title: "",
    publisher: "",
    label: "",
    contractDate: "",
    finishDate: "",
    releaseDate: "",
    payDay1: "",
    payDay2: "",
  };

  const [newC, setNewC] = React.useState(emptyContract);
  const [editingIndex, setEditingIndex] = React.useState(null);
  

  const saveContracts = (data) => {
    setContracts(data);
    localStorage.setItem("writer_contracts_v1", JSON.stringify(data));
  };

  const addContract = () => {
    if (!newC.title) return alert("ì‘í’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”.");
    let updated = [...contracts];
    if (editingIndex !== null) {
      updated[editingIndex] = newC;
      setEditingIndex(null);
    } else {
      updated = [...contracts, newC];
    }
    saveContracts(updated);
    setNewC(emptyContract);
  };

  const removeContract = (i) => {
    const updated = [...contracts];
    updated.splice(i, 1);
    saveContracts(updated);
  };

  const editContract = (i) => {
    setNewC(contracts[i]);
    setEditingIndex(i);
  };

  return (
    <div
      className={`${
        darkMode
          ? "bg-gray-850 text-gray-200 border-gray-700"
          : "bg-white text-gray-900 border-gray-200"
      } p-4 rounded-lg mb-6`}
    >
      <h2 className="font-semibold text-lg mb-4">ğŸ“‘ ê³„ì•½ ê´€ë¦¬</h2>

      <div className="space-y-4">
        {/* ì…ë ¥ í¼ */}
        <div className="space-y-3">
          <div className="grid md:grid-cols-3 gap-4 text-sm">
            {[
              { label: "ì‘í’ˆëª…", key: "title" },
              { label: "ì¶œíŒì‚¬", key: "publisher" },
              { label: "ë ˆì´ë¸”", key: "label" },
            ].map((f) => (
              <div key={f.key} className="flex flex-col">
                <label className="text-xs font-semibold text-indigo-300 mb-1">
                  {f.label}
                </label>
                <input
                  type="text"
                  value={newC[f.key]}
                  onChange={(e) =>
                    setNewC({ ...newC, [f.key]: e.target.value })
                  }
                  className="p-2 border rounded w-full"
                />
              </div>
            ))}
          </div>

          <div className="grid md:grid-cols-4 gap-4 text-sm">
            <div className="flex flex-col">
              <label className="text-xs font-semibold text-indigo-300 mb-1">
                ê³„ì•½ì¼
              </label>
              <input
                type="date"
                value={newC.contractDate}
                onChange={(e) =>
                  setNewC({ ...newC, contractDate: e.target.value })
                }
                className="p-2 border rounded w-full"
              />
            </div>
            <div className="flex flex-col">
              <label className="text-xs font-semibold text-indigo-300 mb-1">
                ì™„ê³ ì¼
              </label>
              <input
                type="date"
                value={newC.finishDate}
                onChange={(e) =>
                  setNewC({ ...newC, finishDate: e.target.value })
                }
                className="p-2 border rounded w-full"
              />
            </div>
            <div className="flex flex-col">
              <label className="text-xs font-semibold text-indigo-300 mb-1">
                ì¶œê°„ì¼
              </label>
              <input
                type="date"
                value={newC.releaseDate}
                onChange={(e) =>
                  setNewC({ ...newC, releaseDate: e.target.value })
                }
                className="p-2 border rounded w-full"
              />
            </div>
            <div className="flex flex-col">
              <label className="text-xs font-semibold text-indigo-300 mb-1">
                ì •ì‚°ì¼ (ë§¤ì›”)
              </label>
              <div className="flex gap-2">
                <input
                  type="number"
                  min="1"
                  max="31"
                  placeholder="ì •ì‚°1"
                  value={newC.payDay1}
                  onChange={(e) =>
                    setNewC({ ...newC, payDay1: e.target.value })
                  }
                  className="p-2 border rounded w-full"
                />
                <input
                  type="number"
                  min="1"
                  max="31"
                  placeholder="ì •ì‚°2"
                  value={newC.payDay2}
                  onChange={(e) =>
                    setNewC({ ...newC, payDay2: e.target.value })
                  }
                  className="p-2 border rounded w-full"
                />
              </div>
            </div>
          </div>
        </div>

        <button
          onClick={addContract}
          className="px-4 py-2 bg-indigo-500 text-white rounded-lg text-sm"
        >
          {editingIndex !== null ? "âœ“ ìˆ˜ì • ì™„ë£Œ" : "+ ê³„ì•½ ì¶”ê°€"}
        </button>

        {contracts.length === 0 ? (
          <p className="text-sm text-gray-500">ë“±ë¡ëœ ê³„ì•½ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        ) : (
          <table className="w-full text-sm mt-3 border-collapse">
            <thead>
              <tr className="border-b text-indigo-300">
                <th>ì‘í’ˆëª…</th>
                <th>ì¶œíŒì‚¬</th>
                <th>ë ˆì´ë¸”</th>
                <th>ê³„ì•½</th>
                <th>ì™„ê³ </th>
                <th>ì¶œê°„</th>
                <th>ì •ì‚°1</th>
                <th>ì •ì‚°2</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {contracts.map((c, i) => (
                <tr key={i} className="border-b hover:bg-gray-800">
                  <td>{c.title}</td>
                  <td>{c.publisher}</td>
                  <td>{c.label}</td>
                  <td>{c.contractDate}</td>
                  <td>{c.finishDate}</td>
                  <td>{c.releaseDate}</td>
                  <td>{c.payDay1 && `ë§¤ì›” ${c.payDay1}ì¼`}</td>
                  <td>{c.payDay2 && `ë§¤ì›” ${c.payDay2}ì¼`}</td>
                  <td className="text-right space-x-2">
                    <button
                      onClick={() => editContract(i)}
                      className="text-indigo-400 text-xs"
                    >
                      ìˆ˜ì •
                    </button>
                    <button
                      onClick={() => removeContract(i)}
                      className="text-red-400 text-xs"
                    >
                      ì‚­ì œ
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
}


      function PlannerApp() {
const [darkMode, setDarkMode] = useState(false);

// âœ… ë‹¤í¬ëª¨ë“œ ë¶ˆëŸ¬ì˜¤ê¸°
useEffect(() => {
  const saved = localStorage.getItem("darkMode");
  if (saved) setDarkMode(saved === "true");
}, []);

// âœ… ë‹¤í¬ëª¨ë“œ ì €ì¥
useEffect(() => {
  localStorage.setItem("darkMode", darkMode);
  if (darkMode) {
    document.documentElement.classList.add("dark");
  } else {
    document.documentElement.classList.remove("dark");
  }
}, [darkMode]);

        const [tab, setTab] = useState("log");
        const [dateStr, setDateStr] = useState(fmtDate(new Date()));
        const [store, setStore] = useState({});
        const [filterProject, setFilterProject] = useState(PROJECTS[0]);
        const [showLogs, setShowLogs] = useState(true);

      


        // ğŸ§© ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        useEffect(() => {
          const raw = localStorage.getItem("writer_planner_store_v4");
          if (raw) {
            try {
              setStore(JSON.parse(raw));
            } catch (e) {
              console.error("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", e);
            }
          }
        }, []);

        // ğŸ’¾ ì €ì¥
        useEffect(() => {
          localStorage.setItem("writer_planner_store_v4", JSON.stringify(store));
        }, [store]);

        // âœ… ë‚ ì§œë³„/ì‘í’ˆë³„ ë°ì´í„° ì ‘ê·¼
        const day = store[dateStr] ?? emptyDay();
        const setDay = (upd) =>
          setStore((prev) => ({
            ...prev,
            [dateStr]:
              typeof upd === "function"
                ? upd(prev[dateStr] ?? emptyDay())
                : upd,
          }));

        const projectData = day[filterProject] ?? emptyProject();
        const setProjectData = (upd) => {
          setDay((cur) => {
            const copy = JSON.parse(JSON.stringify(cur ?? emptyDay()));
            copy[filterProject] =
              typeof upd === "function"
                ? upd(copy[filterProject] ?? emptyProject())
                : upd;
            return copy;
          });
        };

        // ğŸ” ë‚ ì§œ ì „í™˜
        const nextDay = (delta) => {
          const d = new Date(dateStr);
          d.setDate(d.getDate() + delta);
          setDateStr(fmtDate(d));
        };

        // ğŸ§± ë¡œê·¸ ì¶”ê°€
        const addLog = (currentWords) => {
          setProjectData((cur) => {
            const data = JSON.parse(JSON.stringify(cur ?? emptyProject()));
            const logs = data.logs || [];
            const base =
              logs.length > 0
                ? logs[logs.length - 1].currentWords
                : data.startWords || 0;
            const diff = Math.max(0, currentWords - base);
            logs.push({
              time: new Date().toLocaleTimeString("ko-KR", {
                hour: "2-digit",
                minute: "2-digit",
              }),
              currentWords,
              diff,
            });
            data.logs = logs;
            return data;
          });
        };

        // âŒ ë¡œê·¸ ì‚­ì œ
        const removeLog = (idx) => {
          setProjectData((cur) => {
            const data = JSON.parse(JSON.stringify(cur ?? emptyProject()));
            data.logs.splice(idx, 1);
            return data;
          });
        };

        // ğŸ“Š í†µê³„ ê³„ì‚°
        const totalWords = Object.values(day).reduce(
  (sum, proj) =>
    sum + ((proj.logs || []).reduce((s, l) => s + (l.diff || 0), 0)),
  0
);

// ğŸ”§ í”„ë¡œì íŠ¸ë³„ í†µê³„ ê³„ì‚° í•¨ìˆ˜ (ì„ì‹œ ë²„ì „)
function getProjectStats(proj) {
  const projData = day[proj] || emptyProject();
const logs = projData.logs || [];
const total = logs.reduce((s, l) => s + (l.diff || 0), 0);

  const sessions = logs.length;
  const avg = sessions > 0 ? Math.round(total / sessions) : 0;

  // ğŸ•’ ëˆ„ì  ì‹œê°„ ê³„ì‚° (ì„¸ì…˜ 1ê°œ = 0.5ì‹œê°„ ê°€ì •)
  const hours = sessions * 0.5;

  return {
  total,
  sessions,
  avg,
  hours,
  startTime: projData.startTime || "--:--",
  startCount: projData.startWords || 0,
  goal: 5000,
};

}


// ğŸ”§ í”„ë¡œì íŠ¸ ìƒì„¸ ì—´ê¸° (ì„ì‹œ)
function openProjectDetail(proj) {
  alert(`${proj} ìƒì„¸ ë³´ê¸° (ì¶”í›„ êµ¬í˜„ ì˜ˆì •)`);
}

// ğŸ¬ ì‘í’ˆ ìƒì„¸ ëª¨ë‹¬
const [activeProject, setActiveProject] = useState(null);

const ProjectModal = ({ proj, onClose }) => {
  const dayData = store[dateStr]?.[proj] || {};
  const logs = dayData.logs || [];
  const total = logs.reduce((sum, l) => sum + (l.diff || 0), 0);
  const sessions = logs.length;
  const avg = sessions > 0 ? Math.round(total / sessions) : 0;

  const [memo, setMemo] = useState(dayData.memo || "");

  const saveMemo = () => {
    setStore((prev) => {
      const copy = JSON.parse(JSON.stringify(prev));
      if (!copy[dateStr]) copy[dateStr] = {};
      if (!copy[dateStr][proj]) copy[dateStr][proj] = {};
      copy[dateStr][proj].memo = memo;
      return copy;
    });
  };

  return (
    
  <div
    className="fixed inset-0 bg-black/40 flex items-center justify-center z-50"
    onClick={onClose} // ë°°ê²½ í´ë¦­ ì‹œ ë‹«í˜
  >
    <div
      className={`${darkMode ? "bg-gray-800 text-gray-400 border-gray-600" : "bg-white text-gray-900 border-gray-300"} p-4 rounded-lg relative`}
      onClick={(e) => e.stopPropagation()} // ë‚´ë¶€ í´ë¦­ì€ ë‹«íˆì§€ ì•ŠìŒ
    >
      <button
        onClick={onClose}
        className="absolute top-3 right-3 text-gray-500 hover:text-gray-800"
      >
        âœ•
      </button>


        <h2 className="text-xl font-bold text-indigo-600 mb-4">{proj}</h2>

        {/* ìš”ì•½ */}
        <div className="grid grid-cols-3 gap-2 text-center mb-4">
          <div>
            <div className="text-sm text-gray-500">ì´í•©</div>
            <div className="font-semibold text-indigo-600">
              {total.toLocaleString()}ì
            </div>
          </div>
          <div>
            <div className="text-sm text-gray-500">ì„¸ì…˜</div>
            <div className="font-semibold">{sessions}</div>
          </div>
          <div>
            <div className="text-sm text-gray-500">í‰ê· </div>
            <div className="font-semibold">
              {avg.toLocaleString()}ì
            </div>
          </div>
        

      {/* ğŸ§© ë¡œê·¸ ëª©ë¡ (ì ‘ê¸°/í¼ì¹˜ê¸° í† ê¸€) */}
<div className="mb-3">
  <button
    onClick={() => setShowLogs(!showLogs)}
    className={`text-sm mb-2 px-3 py-1 rounded-md border ${
      darkMode
        ? "border-gray-600 text-indigo-300 hover:bg-gray-800"
        : "border-gray-300 text-indigo-600 hover:bg-indigo-50"
    }`}
  >
    {showLogs ? "â–¼ ë¡œê·¸ ì ‘ê¸°" : "â–¶ ë¡œê·¸ ì—´ê¸°"}{" "}
    ({(projectData.logs ?? []).length}ê°œ)
  </button>

  {showLogs &&
    ((projectData.logs ?? []).length === 0 ? (
      <div className="text-gray-500 text-sm">ê¸°ë¡ ì—†ìŒ</div>
    ) : (
      [...(projectData.logs ?? [])]
        .sort((a, b) => parseKoreanTime(b.time) - parseKoreanTime(a.time))
        .map((l, i) => (
          <div
            key={i}
            className={`flex justify-between items-center p-2 mb-1 rounded-lg ${
              darkMode
                ? "bg-gray-800 text-gray-200 border border-gray-700"
                : "bg-gray-50 text-gray-900 border border-gray-200"
            }`}
          >
            <span>{l.time}</span>
            <span>{l.diff.toLocaleString()}ì</span>
            <button
              onClick={() => removeLog(i)}
              className="text-xs text-red-500"
            >
              ì‚­ì œ
            </button>
          </div>
        ))
    ))}
</div>




        </div>
{/* ğŸ“… ìµœê·¼ 7ì¼ ê¸°ë¡ ìš”ì•½ */}
<div className="mb-4">
  <h3 className="text-sm font-semibold text-indigo-700 mb-2">ğŸ“… ìµœê·¼ 7ì¼ ì§‘í•„ ê¸°ë¡</h3>
  <div className="bg-gray-50 rounded-lg p-3 text-sm">
    {(() => {
      const today = new Date(dateStr);
      const last7 = [];
      for (let i = 6; i >= 0; i--) {
        const d = new Date(today);
        d.setDate(today.getDate() - i);
        const key = fmtDate(d);
        const logs = store[key]?.[proj]?.logs || [];
        const total = logs.reduce((s, l) => s + (l.diff || 0), 0);
        if (total > 0) last7.push({ date: key.slice(5), total });
      }

      if (last7.length === 0)
        return <p className="text-gray-400 text-xs">ìµœê·¼ 7ì¼ê°„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>;

      return (
        <div className="space-y-1">
          {last7.map((d, i) => (
            <div
              key={i}
              className="flex justify-between border-b border-dashed border-gray-200 last:border-none"
            >
              <span>{d.date}</span>
              <span className="text-indigo-600">{d.total.toLocaleString()}ì</span>
            </div>
          ))}
        </div>
      );
    })()}
  </div>
</div>

{/* ğŸ“Š ëˆ„ì  ìš”ì•½ */}
<div className="border-t border-gray-200 pt-3 mb-4 text-sm">
  {(() => {
    const allDays = Object.entries(store);
    let total = 0;
    let sessions = 0;
    allDays.forEach(([_, data]) => {
      const logs = data[proj]?.logs || [];
      total += logs.reduce((s, l) => s + (l.diff || 0), 0);
      sessions += logs.length;
    });
    const avg = sessions > 0 ? Math.round(total / sessions) : 0;

    return (
      <div className="grid grid-cols-3 text-center text-gray-700">
        <div>
          <div className="text-gray-500 text-xs">ëˆ„ì  ì´í•©</div>
          <div className="font-semibold text-indigo-600">{total.toLocaleString()}ì</div>
        </div>
        <div>
          <div className="text-gray-500 text-xs">ì„¸ì…˜ ìˆ˜</div>
          <div className="font-semibold">{sessions}</div>
        </div>
        <div>
          <div className="text-gray-500 text-xs">í‰ê· </div>
          <div className="font-semibold">{avg.toLocaleString()}ì</div>
        </div>
      </div>
    );
  })()}
</div>

        {/* ë©”ëª¨ */}
        <div>
          <textarea
            value={memo}
            onChange={(e) => setMemo(e.target.value)}
            className="w-full border rounded-lg p-2 text-sm h-20"
            placeholder="ì˜¤ëŠ˜ì˜ ì‘ì—… ì†Œê°ì´ë‚˜ ë©”ëª¨ë¥¼ ì ì–´ë³´ì„¸ìš”"
          />
          <button
            onClick={saveMemo}
            className="mt-2 px-4 py-2 bg-indigo-500 text-white rounded-lg text-sm"
          >
            ğŸ’¾ ë©”ëª¨ ì €ì¥
          </button>
        </div>
      </div>
    </div>
  );
};

        return (
          <div
  className={`max-w-4xl mx-auto p-6 transition-colors duration-300 ${
  darkMode ? "bg-gray-900 text-gray-300" : "bg-gray-50 text-gray-900"
}`}
>

            <h1 className="text-2xl sm:text-3xl font-bold mb-6">ì‘ê°€ìš© ì‘ì—… í”Œë˜ë„ˆ</h1>
{/* ğŸŒ— ë¼ì´íŠ¸ëª¨ë“œ + ë¶ë§ˆí¬ ë²„íŠ¼ë°” */}
<div className="flex flex-wrap items-center justify-between mb-4">
  {/* ë¼ì´íŠ¸ëª¨ë“œ ë²„íŠ¼ */}
  <button
    onClick={() => setDarkMode(!darkMode)}
    className={`px-4 py-2 rounded-lg transition ${
      darkMode
        ? "bg-gray-700 hover:bg-gray-600 text-yellow-300"
        : "bg-white hover:bg-gray-100 text-gray-700 border"
    }`}
  >
    {darkMode ? "â˜€ï¸ ë¼ì´íŠ¸ëª¨ë“œ" : "ğŸŒ™ ë‹¤í¬ëª¨ë“œ"}
  </button>

  {/* ğŸ“ ë¶ë§ˆí¬ ë²„íŠ¼ */}
  <div className="flex gap-2">
    <button
      onClick={() =>
        document.getElementById("log-section")?.scrollIntoView({ behavior: "smooth" })
      }
      className={`px-3 py-1 text-sm rounded-lg transition
  ${darkMode
    ? "bg-gray-700 text-gray-100 hover:bg-gray-600 border border-gray-600"
    : "bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-200"
  }`}
    >
      ë¡œê·¸
    </button>
    <button
      onClick={() =>
        document.getElementById("monthly-section")?.scrollIntoView({ behavior: "smooth" })
      }
      className={`px-3 py-1 text-sm rounded-lg transition
  ${darkMode
    ? "bg-gray-700 text-gray-100 hover:bg-gray-600 border border-gray-600"
    : "bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-200"
  }`}
    >
      ì›”ê°„
    </button>
    <button
  onClick={() =>
    document
      .getElementById("calendar-section")
      ?.scrollIntoView({ behavior: "smooth" })
  }
  className={`px-3 py-1 text-sm rounded-lg transition
  ${
    darkMode
      ? "bg-gray-700 text-gray-100 hover:bg-gray-600 border border-gray-600"
      : "bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-200"
  }`}
>
  ìº˜ë¦°ë”
</button>

    <button
      onClick={() =>
        document.getElementById("contract-section")?.scrollIntoView({ behavior: "smooth" })
      }
      className={`px-3 py-1 text-sm rounded-lg transition
  ${darkMode
    ? "bg-gray-700 text-gray-100 hover:bg-gray-600 border border-gray-600"
    : "bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-200"
  }`}
    >
      ê³„ì•½
    </button>

    <button
  onClick={() =>
    document.getElementById("royalty-section")?.scrollIntoView({ behavior: "smooth" })
  }
  className={`px-3 py-1 text-sm rounded-lg transition
  ${darkMode
    ? "bg-gray-700 text-gray-100 hover:bg-gray-600 border border-gray-600"
    : "bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-200"
  }`}
>
  ì¸ì„¸
</button>

  </div>
</div>



           

            {/* ğŸ”¸ ë‚ ì§œ + ì‘í’ˆ ì„ íƒ (í•œ ì¤„ ì •ë ¬) */}
<div className="flex flex-wrap items-center gap-3 mb-4">
  <div className="flex items-center gap-2">
    <button
      onClick={() => nextDay(-1)}
      className="px-3 py-1 bg-gray-200 rounded-lg"
    >
      â—€
    </button>
    <input
      type="date"
      value={dateStr}
      onChange={(e) => setDateStr(e.target.value)}
      className="border rounded-lg p-2"
    />
    <button
      onClick={() => nextDay(1)}
      className="px-3 py-1 bg-gray-200 rounded-lg"
    >
      â–¶
    </button>
  </div>

  {/* ğŸ”¸ ì‘í’ˆ ë“œë¡­ë‹¤ìš´ì„ ì˜¤ë¥¸ìª½ì— ë°°ì¹˜ */}
  <select
    value={filterProject}
    onChange={(e) => setFilterProject(e.target.value)}
    className="p-2 border rounded-lg min-w-[160px]"
  >
    {PROJECTS.map((p) => (
      <option key={p}>{p}</option>
    ))}
  </select>
</div>


            {/* ğŸŒ… ì‘í’ˆë³„ ì‹œì‘ ì •ë³´ */}
            <div className={`${darkMode ? "bg-gray-850 text-gray-200 border border-gray-700" : "bg-indigo-50 text-gray-900 border border-gray-200"} p-4 rounded-lg mb-4`}>

              <h3 className="font-semibold mb-2 text-indigo-700">
                ğŸŒ… {filterProject} ì‹œì‘ ì •ë³´
              </h3>

              <div className="flex gap-4 mb-2 items-center">
                <label className="text-sm w-24">ì‹œì‘ ì‹œê°„</label>
                <input
                  type="time"
                  value={projectData.startTime || ""}
                  onChange={(e) =>
                    setProjectData((cur) => ({
                      ...cur,
                      startTime: e.target.value,
                    }))
                  }
                  className="p-2 border rounded-lg w-40"
                />
              </div>

              <div className="flex gap-4 items-center">
                <label className="text-sm w-24">ì‹œì‘ ê¸€ììˆ˜</label>
                <input
                  type="number"
                  value={projectData.startWords || ""}
                  onChange={(e) =>
                    setProjectData((cur) => ({
                      ...cur,
                      startWords: Number(e.target.value) || 0,
                    }))
                  }
                  className="p-2 border rounded-lg w-40"
                />
              </div>
            </div>

            {/* ğŸ§± ë¡œê·¸ ì…ë ¥ */}
            {/* ğŸ§± ë¡œê·¸ ì…ë ¥ + ì˜¤ëŠ˜ ì´í•© í‘œì‹œ */}
           <div
  id="log-section"
  className="flex items-center gap-3 mb-4"
>

  <div className="flex gap-2 flex-grow">
    <input
      id="currentWords"
      type="number"
      placeholder="í˜„ì¬ ê¸€ììˆ˜"
      className="p-2 border rounded-lg w-32"
    />
    <button
      onClick={() => {
        const cur = Number(
          document.getElementById("currentWords").value || 0
        );
        if (cur <= 0) return alert("í˜„ì¬ ê¸€ììˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
        addLog(cur);
        document.getElementById("currentWords").value = "";
      }}
      className="px-4 py-2 bg-indigo-500 text-white rounded-lg"
    >
      + ê¸°ë¡
    </button>
  </div>

  {/* ğŸ”¹ ì˜¤ëŠ˜ ì´í•© í‘œì‹œ */}
  <div className="text-sm font-semibold text-indigo-400 whitespace-nowrap">
    ì˜¤ëŠ˜ ì´í•©:{" "}
    <span className="text-indigo-300">
      {totalWords.toLocaleString()}ì
    </span>
  </div>
</div>


         {/* ğŸ§© ë¡œê·¸ ëª©ë¡ (ì ‘ê¸°/í¼ì¹˜ê¸° í† ê¸€) */}
<div className="mb-3">
  <button
    onClick={() => setShowLogs(!showLogs)}
    className={`text-sm mb-2 px-3 py-1 rounded-md border ${
      darkMode
        ? "border-gray-600 text-indigo-300 hover:bg-gray-800"
        : "border-gray-300 text-indigo-600 hover:bg-indigo-50"
    }`}
  >
    {showLogs ? "â–¼ ë¡œê·¸ ì ‘ê¸°" : "â–¶ ë¡œê·¸ ì—´ê¸°"}{" "}
    ({(projectData.logs ?? []).length}ê°œ)
  </button>

  {showLogs &&
    ((projectData.logs ?? []).length === 0 ? (
      <div className="text-gray-500 text-sm">ê¸°ë¡ ì—†ìŒ</div>
    ) : (
      [...(projectData.logs ?? [])]
        .sort((a, b) => parseKoreanTime(b.time) - parseKoreanTime(a.time))
        .map((l, i) => (
          <div
            key={i}
            className={`flex justify-between items-center p-2 mb-1 rounded-lg ${
              darkMode
                ? "bg-gray-800 text-gray-200 border border-gray-700"
                : "bg-gray-50 text-gray-900 border border-gray-200"
            }`}
          >
            <span>{l.time}</span>
            <span>{l.diff.toLocaleString()}ì</span>
            <button
              onClick={() => {
  const originalIndex = projectData.logs.findIndex(
    (x) => x.time === l.time && x.currentWords === l.currentWords
  );
  removeLog(originalIndex);
}}

              className="text-xs text-red-500"
            >
              ì‚­ì œ
            </button>
          </div>
        ))
    ))}
</div>




         

{/* ğŸ“Š ì‘í’ˆë³„ ìš”ì•½ í†µê³„ */}
<div className={`${darkMode 
  ? "bg-gray-850 text-gray-200 border-gray-700" 
  : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}>


  <h2 className="font-semibold text-lg mb-4">ğŸ“Š ì˜¤ëŠ˜ì˜ ì‘í’ˆë³„ ìš”ì•½</h2>

  {(() => {
    const today = store[dateStr] || {};
    const projectSummaries = Object.entries(today).map(([proj, data]) => {
      const logs = data.logs || [];
      const total = logs.reduce((sum, l) => sum + (l.diff || 0), 0);
      const sessions = logs.length;
      const avg = sessions > 0 ? Math.round(total / sessions) : 0;
      return { proj, total, sessions, avg };
    });

    const grandTotal = projectSummaries.reduce((s, p) => s + p.total, 0);

    if (projectSummaries.length === 0) {
      return <p className="text-gray-500 text-sm">ì˜¤ëŠ˜ ê¸°ë¡ëœ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>;
    }

    return (
      <>
        {/* ì „ì²´ ì´í•© */}
        <div className={`flex justify-between items-center mb-4 p-3 rounded-lg ${
  darkMode ? "bg-gray-800 text-gray-200 border border-gray-700" : "bg-indigo-50 text-gray-900 border border-gray-200"
}`}>

          <span className="font-semibold text-indigo-700">ì „ì²´ í•©ê³„</span>
          <span className="font-bold text-indigo-600 text-lg">
            {grandTotal.toLocaleString()}ì
          </span>
        </div>

        {/* ì‘í’ˆë³„ í‘œ */}
        <table className="w-full border-collapse mb-6 text-sm">
          <thead>
  <tr
    className={`text-left ${
      darkMode
        ? "bg-gray-900 text-indigo-300 border-b border-gray-700"
        : "bg-gray-100 text-indigo-600 border-b border-gray-300"
    }`}
  >
    <th className="px-4 py-2">ì‘í’ˆëª…</th>
    <th className="px-4 py-2">ì„¸ì…˜ ìˆ˜</th>
    <th className="px-4 py-2">ì´í•©</th>
    <th className="px-4 py-2">í‰ê· </th>
  </tr>
</thead>

          <tbody>
            {projectSummaries.map((p) => (
              <tr key={p.proj} className="hover:bg-gray-50">
                <td className="border p-2 text-indigo-600 font-medium">{p.proj}</td>
                <td className="border p-2 text-center">{p.sessions}</td>
                <td className="border p-2 text-center text-indigo-700">
                  {p.total.toLocaleString()}ì
                </td>
                <td className="border p-2 text-center text-gray-700">
                  {p.avg.toLocaleString()}ì
                </td>
              </tr>
            ))}
          </tbody>
        </table>

        {/* ê·¸ë˜í”„ */}
        <h3 className="font-semibold mb-2 text-gray-700">ğŸ“ˆ ì‹œê°í™”</h3>
        <div className={`graph-area flex items-end gap-2 h-48 p-4 rounded-lg overflow-x-auto ${
  darkMode ? "text-gray-200" : "text-gray-900"
}`}>


          {projectSummaries.map((p) => {
            const maxValue = Math.max(...projectSummaries.map((x) => x.total), 1);
            const height = (p.total / maxValue) * 160;
            return (
              <div key={p.proj} className="flex flex-col items-center justify-end flex-1">
                <div
                  className="bg-indigo-500 rounded-t w-6"
                  style={{ height: `${height}px` }}
                ></div>
                <span className="text-xs mt-2 text-center break-keep">{p.proj}</span>
              </div>
            );
          })}
        </div>
      </>
    );
  })()}
</div>
{/* ğŸ“… ì›”ê°„ / ì—°ê°„ ëˆ„ì  í†µê³„ */}
<div id="monthly-section"
  className={`${darkMode 
    ? "bg-gray-850 text-gray-200 border-gray-700" 
    : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}
>

  <h2 className="font-semibold text-lg mb-4">ğŸ“… ì›”ê°„ Â· ì—°ê°„ ëˆ„ì  í†µê³„</h2>

  {(() => {
    const now = new Date(dateStr);
    const year = now.getFullYear();
    const month = now.getMonth();

    // ì›”ê°„ ëˆ„ì 
    const monthlyTotals = {};
    Object.entries(store).forEach(([day, data]) => {
      const d = new Date(day);
      if (d.getFullYear() === year && d.getMonth() === month) {
        Object.entries(data || {}).forEach(([proj, val]) => {
          if (!val.logs) return;
          const total = val.logs.reduce((s, l) => s + (l.diff || 0), 0);
          monthlyTotals[proj] = (monthlyTotals[proj] || 0) + total;
        });
      }
    });

    // ì—°ê°„ ëˆ„ì 
    const yearlyTotals = {};
    Object.entries(store).forEach(([day, data]) => {
      const d = new Date(day);
      if (d.getFullYear() === year) {
        Object.entries(data || {}).forEach(([proj, val]) => {
          if (!val.logs) return;
          const total = val.logs.reduce((s, l) => s + (l.diff || 0), 0);
          yearlyTotals[proj] = (yearlyTotals[proj] || 0) + total;
        });
      }
    });

    const monthlySorted = Object.entries(monthlyTotals).sort((a, b) => b[1] - a[1]);
    const yearlySorted = Object.entries(yearlyTotals).sort((a, b) => b[1] - a[1]);

    const maxMonth = Math.max(...monthlySorted.map(([_, v]) => v), 1);
    const maxYear = Math.max(...yearlySorted.map(([_, v]) => v), 1);

    return (
      <>
        {/* ì›”ê°„ ìš”ì•½ */}
        <div className="mb-8">
          <h3 className="font-semibold mb-2 text-indigo-700">ğŸ“† ì´ë²ˆ ë‹¬ ëˆ„ì </h3>
          {monthlySorted.length === 0 ? (
            <p className="text-gray-500 text-sm">ì´ë²ˆ ë‹¬ ì‘ì„± ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          ) : (
            <>
              <ul className="text-sm mb-4">
                {monthlySorted.map(([proj, val]) => (
                  <li key={proj} className="flex justify-between border-b py-1">
                    <span className="text-indigo-600">{proj}</span>
                    <span>{val.toLocaleString()}ì</span>
                  </li>
                ))}
              </ul>
              <div className={`flex items-end gap-2 h-40 p-3 rounded-lg overflow-x-auto ${
  darkMode ? "bg-gray-800 text-gray-200" : "bg-gray-50 text-gray-900"
}`}>

                {monthlySorted.map(([proj, val]) => (
                  <div key={proj} className="flex flex-col items-center justify-end flex-1">
                    <div
                      className="bg-indigo-400 rounded-t w-6"
                      style={{ height: `${(val / maxMonth) * 150}px` }}
                    ></div>
                    <span className="text-xs mt-2 text-center break-keep">{proj}</span>
                  </div>
                ))}
              </div>
            </>
          )}
        </div>

        {/* ì—°ê°„ ìš”ì•½ */}
        <div>
          <h3 className="font-semibold mb-2 text-indigo-700">ğŸ“˜ ì˜¬í•´ ëˆ„ì </h3>
          {yearlySorted.length === 0 ? (
            <p className="text-gray-500 text-sm">ì˜¬í•´ ì‘ì„± ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          ) : (
            <>
              <ul className="text-sm mb-4">
                {yearlySorted.map(([proj, val]) => (
                  <li key={proj} className="flex justify-between border-b py-1">
                    <span className="text-indigo-600">{proj}</span>
                    <span>{val.toLocaleString()}ì</span>
                  </li>
                ))}
              </ul>
              <div className="graph-area flex items-end gap-2 h-48 p-3 rounded-lg overflow-x-auto">
                {yearlySorted.map(([proj, val]) => (
                  <div key={proj} className="flex flex-col items-center justify-end flex-1">
                    <div
                      className="bg-indigo-500 rounded-t w-6"
                      style={{ height: `${(val / maxYear) * 160}px` }}
                    ></div>
                    <span className="text-xs mt-2 text-center break-keep">{proj}</span>
                  </div>
                ))}
              </div>
            </>
          )}
        </div>
      </>
    );
  })()}
</div>
{/* ğŸ¯ ì‘í’ˆë³„ ëª©í‘œ ëŒ€ë¹„ ì§„í–‰ë¥  */}
<div className={`${darkMode 
  ? "bg-gray-850 text-gray-200 border-gray-700" 
  : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}>



  <h2 className="font-semibold text-lg mb-4">ğŸ¯ ì‘í’ˆë³„ ëª©í‘œ ì§„í–‰ë¥ </h2>

  {(() => {
    // ëª©í‘œ ë¶ˆëŸ¬ì˜¤ê¸°
    const raw = localStorage.getItem("writer_targets");
    const targets = raw ? JSON.parse(raw) : {};

    // ëª©í‘œ ìˆ˜ì •
    const updateTarget = (proj, val) => {
      const updated = { ...targets, [proj]: val };
      localStorage.setItem("writer_targets", JSON.stringify(updated));
      alert(`${proj} ëª©í‘œê°€ ${val.toLocaleString()}ìë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    };

    // ê° ì‘í’ˆë³„ ì´í•©
    const projectTotals = {};
    Object.entries(store).forEach(([_, data]) => {
      Object.entries(data || {}).forEach(([proj, val]) => {
        if (!val.logs) return;
        const total = val.logs.reduce((s, l) => s + (l.diff || 0), 0);
        projectTotals[proj] = (projectTotals[proj] || 0) + total;
      });
    });

    const entries = Object.entries(projectTotals).sort((a, b) => b[1] - a[1]);

    if (entries.length === 0) {
      return <p className="text-gray-500 text-sm">ê¸°ë¡ëœ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>;
    }

    return (
      <div className="space-y-4">
        {entries.map(([proj, total]) => {
          const goal = targets[proj] || 0;
          const progress = goal > 0 ? Math.min(100, (total / goal) * 100) : 0;
          const barColor =
            progress >= 100
              ? "bg-green-500"
              : progress >= 70
              ? "bg-indigo-500"
              : "bg-gray-300";

          return (
            <div key={proj} className="p-3 border rounded-lg">
              <div className="flex justify-between items-center mb-2">
                <span className="font-medium text-indigo-700">{proj}</span>
                <span className="text-sm text-gray-600">
                  {goal > 0 ? `${progress.toFixed(1)}%` : "ëª©í‘œ ë¯¸ì„¤ì •"}
                </span>
              </div>

              {/* ì§„í–‰ë¥  ë°” */}
              <div className="w-full bg-gray-200 h-3 rounded-full overflow-hidden mb-2">
                <div
                  className={`${barColor} h-3 transition-all duration-300`}
                  style={{ width: `${progress}%` }}
                ></div>
              </div>

              {/* ëª©í‘œ ì…ë ¥ */}
              <div className="flex items-center gap-2">
                <input
                  type="number"
                  placeholder="ëª©í‘œ ê¸€ììˆ˜"
                  defaultValue={goal || ""}
                  className="p-1 border rounded-lg w-32 text-sm"
                  id={`goal-${proj}`}
                />
                <button
                  className="px-3 py-1 text-xs bg-indigo-500 text-white rounded-lg"
                  onClick={() => {
                    const val = Number(document.getElementById(`goal-${proj}`).value || 0);
                    updateTarget(proj, val);
                  }}
                >
                  ì €ì¥
                </button>
              </div>

              {/* í˜„ì¬ ì´í•© */}
              <div className="text-xs text-gray-500 mt-1">
                í˜„ì¬ {total.toLocaleString()}ì / ëª©í‘œ{" "}
                {goal > 0 ? goal.toLocaleString() : "ë¯¸ì„¤ì •"}
              </div>
            </div>
          );
        })}
      </div>
    );
  })()}
</div>
{/* ğŸ“… ì‘í’ˆë³„ í‰ê·  ì‘ì„± ì†ë„ & ìµœê³  ìƒì‚°ì¼ */}
<div className={`${darkMode 
  ? "bg-gray-850 text-gray-200 border-gray-700" 
  : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}>



  <h2 className="font-semibold text-lg mb-4">ğŸ“… ì‘í’ˆë³„ í‰ê·  ì‘ì„± ì†ë„ & ìµœê³  ìƒì‚°ì¼</h2>

  {(() => {
    const projectStats = {};

    // storeë¥¼ ìˆœíšŒí•˜ë©° ì‘í’ˆë³„ ì´í•©, ì¼ìˆ˜, ìµœê³  ìƒì‚°ì¼ ê³„ì‚°
    Object.entries(store).forEach(([date, data]) => {
      Object.entries(data || {}).forEach(([proj, val]) => {
        if (!val.logs) return;
        const total = val.logs.reduce((s, l) => s + (l.diff || 0), 0);

        if (!projectStats[proj]) {
          projectStats[proj] = {
            total: 0,
            days: 0,
            daily: {},
            maxDay: "",
            maxAmount: 0,
          };
        }

        projectStats[proj].total += total;
        projectStats[proj].days += 1;
        projectStats[proj].daily[date] = total;

        // ìµœê³  ìƒì‚°ì¼ ê°±ì‹ 
        if (total > projectStats[proj].maxAmount) {
          projectStats[proj].maxAmount = total;
          projectStats[proj].maxDay = date;
        }
      });
    });

    const entries = Object.entries(projectStats).sort(
      (a, b) => b[1].total - a[1].total
    );

    if (entries.length === 0) {
      return <p className="text-gray-500 text-sm">ê¸°ë¡ëœ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>;
    }

    return (
      <div className="space-y-4">
        {entries.map(([proj, info]) => {
          const avgDaily = info.days ? Math.round(info.total / info.days) : 0;

          // ì›”í‰ê·  ê³„ì‚°
          const months = new Set(
            Object.keys(info.daily).map((d) => {
              const [y, m] = d.split("-").map(Number);
              return `${y}-${m}`;
            })
          );
          const avgMonthly = months.size
            ? Math.round(info.total / months.size)
            : info.total;

          return (
            <div key={proj} className="p-3 border rounded-lg">
              <div className="flex justify-between items-center mb-2">
                <span className="font-medium text-indigo-700">{proj}</span>
                <span className="text-sm text-gray-600">
                  ì´ {info.total.toLocaleString()}ì
                </span>
              </div>

              <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 text-center text-sm">
                <div className={`${darkMode ? "bg-gray-850 text-gray-200 border border-gray-700" : "bg-indigo-50 text-gray-900 border border-gray-200"} p-4 rounded-lg mb-4`}>

                  <div className="text-gray-500">ì¼í‰ê· </div>
                  <div className="font-bold text-indigo-600">
                    {avgDaily.toLocaleString()}ì
                  </div>
                </div>
                <div className={`${darkMode ? "bg-gray-850 text-gray-200 border border-gray-700" : "bg-indigo-50 text-gray-900 border border-gray-200"} p-4 rounded-lg mb-4`}>

                  <div className="text-gray-500">ì›”í‰ê· </div>
                  <div className="font-bold text-indigo-600">
                    {avgMonthly.toLocaleString()}ì
                  </div>
                </div>
                <div className={`${darkMode ? "bg-gray-850 text-gray-200 border border-gray-700" : "bg-indigo-50 text-gray-900 border border-gray-200"} p-4 rounded-lg mb-4`}>

                  <div className="text-gray-500">ìµœê³  ìƒì‚°ì¼</div>
                  <div className="font-bold text-indigo-600">
                    {info.maxDay || "-"}
                  </div>
                </div>
              </div>
            </div>
          );
        })}
      </div>
    );
  })()}
</div>
{/* ğŸ”¥ ì˜¤ëŠ˜ì˜ ì§‘í•„ ë­í‚¹ & ëª©í‘œ ë‹¬ì„±ë¥  */}
<div className={`${darkMode 
  ? "bg-gray-850 text-gray-200 border-gray-700" 
  : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}>



  <h2 className="font-semibold text-lg mb-4">ğŸ”¥ ì˜¤ëŠ˜ì˜ ì§‘í•„ ë­í‚¹ & ëª©í‘œ ë‹¬ì„±ë¥ </h2>

  {(() => {
    const today = store[dateStr] || {};
    const entries = Object.entries(today).filter(([k]) => k !== "logs" && k !== "startTime" && k !== "startWords");

    if (entries.length === 0) {
      return <p className="text-gray-500 text-sm">ì˜¤ëŠ˜ ì‘ì„±ëœ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>;
    }

    const projectRank = entries
      .map(([proj, val]) => {
        const total = (val.logs || []).reduce((s, l) => s + (l.diff || 0), 0);
        const goal = val.goal || 5000; // ê¸°ë³¸ ëª©í‘œ 5ì²œì
        const progress = Math.min(100, (total / goal) * 100);
        return { proj, total, goal, progress };
      })
      .sort((a, b) => b.total - a.total);

    return (
      <div className="space-y-3">
        {projectRank.map((p, idx) => (
          <div key={p.proj} className={`p-3 border rounded-lg ${
  darkMode ? "bg-gray-850 text-gray-200 border-gray-700" : "bg-gray-50 text-gray-900 border-gray-200"
}`}>

            <div className="flex justify-between items-center mb-2">
              <div className="flex items-center gap-2">
                <span className="font-medium text-indigo-700">{p.proj}</span>
                {idx === 0 && <span className="text-red-500 text-lg">ğŸ”¥</span>}
              </div>
              <span className="text-sm text-gray-600">{p.total.toLocaleString()}ì</span>
            </div>

            {/* ì§„í–‰ë¥  ë°” */}
            <div className="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
              <div
                className={`h-3 rounded-full ${
                  p.progress >= 100 ? "bg-green-500" : "bg-indigo-500"
                }`}
                style={{ width: `${p.progress}%` }}
              ></div>
            </div>

            {/* ëª©í‘œëŸ‰ ë° ë‹¬ì„±ë¥  í‘œì‹œ */}
            <div className="flex justify-between text-xs text-gray-500 mt-1">
              <span>ëª©í‘œ: {p.goal.toLocaleString()}ì</span>
              <span>ë‹¬ì„±ë¥ : {p.progress.toFixed(1)}%</span>
            </div>

            {/* ëª©í‘œëŸ‰ ë³€ê²½ */}
            <div className="flex gap-2 mt-2 items-center">
              <input
                type="number"
                placeholder="ëª©í‘œëŸ‰ ìˆ˜ì •"
                defaultValue={p.goal}
                className="w-24 p-1 text-sm border rounded"
                onBlur={(e) => {
                  const newGoal = Number(e.target.value || 0);
                  if (newGoal > 0) {
                    setDay((cur) => {
                      const n = JSON.parse(JSON.stringify(cur ?? emptyDay()));
                      if (!n[p.proj]) n[p.proj] = { logs: [] };
                      n[p.proj].goal = newGoal;
                      return n;
                    });
                  }
                }}
              />
              <span className="text-xs text-gray-400">(ì—”í„° ì—†ì´ í¬ì»¤ìŠ¤ ì•„ì›ƒ ì‹œ ì €ì¥)</span>
            </div>
          </div>
        ))}
      </div>
    );
  })()}
</div>

{/* ğŸ“… ì£¼ê°„ & ì›”ê°„ íŠ¸ë Œë“œ ëŒ€ì‹œë³´ë“œ */}
<div className={`${darkMode 
  ? "bg-gray-850 text-gray-200 border-gray-700" 
  : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}>



  <h2 className="font-semibold text-lg mb-4">ğŸ“… ì£¼ê°„ & ì›”ê°„ íŠ¸ë Œë“œ</h2>

  {(() => {
    const today = new Date(dateStr);
    const past7Days = [];
    for (let i = 6; i >= 0; i--) {
      const d = new Date(today);
      d.setDate(today.getDate() - i);
      const key = fmtDate(d);
      const data = store[key] || {};
      let total = 0;
      Object.values(data).forEach((proj) => {
        if (proj?.logs) total += proj.logs.reduce((s, l) => s + (l.diff || 0), 0);
      });
      past7Days.push({ date: key, total });
    }

    const maxWeekly = Math.max(...past7Days.map((d) => d.total), 1);
    const avgWeekly = past7Days.reduce((a, b) => a + b.total, 0) / 7;

    // ğŸ—“ ì›”ê°„ ë°ì´í„° ê³„ì‚°
    const currentYear = today.getFullYear();
    const currentMonth = today.getMonth();
    const monthData = {};

    Object.entries(store).forEach(([key, val]) => {
      const d = new Date(key);
      if (d.getFullYear() === currentYear && d.getMonth() === currentMonth) {
        const week = Math.ceil(d.getDate() / 7); // 1~4ì£¼ì°¨ ë¶„ë¥˜
        let total = 0;
        Object.values(val).forEach((proj) => {
          if (proj?.logs) total += proj.logs.reduce((s, l) => s + (l.diff || 0), 0);
        });
        monthData[week] = (monthData[week] || 0) + total;
      }
    });

    const monthWeeks = Object.keys(monthData).sort();
    const maxMonthly = Math.max(...Object.values(monthData), 1);

    return (
      <div className="space-y-8">

        {/* ğŸ“† ì£¼ê°„ íŠ¸ë Œë“œ */}
        <section>
          <h3 className="font-semibold text-md mb-2 text-indigo-700">ğŸ“† ìµœê·¼ 7ì¼ê°„ ì§‘í•„ ì¶”ì´</h3>
          <div className={`flex items-end gap-2 h-40 rounded-lg p-2 overflow-x-auto ${
  darkMode ? "bg-gray-800 text-gray-200" : "bg-gray-50 text-gray-900"
}`}>

            {past7Days.map((d, i) => (
              <div key={i} className="flex flex-col items-center justify-end flex-1 min-w-[28px]">
                <div
                  className="bg-indigo-400 rounded-t"
                  style={{ height: `${(d.total / maxWeekly) * 120}px`, width: "18px" }}
                ></div>
                <span className="text-[10px] text-gray-500 mt-1">
                  {d.date.slice(5)}
                </span>
              </div>
            ))}
          </div>
          <div className="text-sm text-gray-600 mt-3">
            ğŸ“ˆ ì¼í‰ê· : <b>{Math.round(avgWeekly).toLocaleString()}ì</b>,  
            ìµœê³ : <b>{Math.max(...past7Days.map((d) => d.total)).toLocaleString()}ì</b>
          </div>
        </section>

        {/* ğŸ—“ ì›”ê°„ íŠ¸ë Œë“œ */}
        <section>
          <h3 className="font-semibold text-md mb-2 text-indigo-700">ğŸ—“ ì´ë²ˆ ë‹¬ ì£¼ì°¨ë³„ í‰ê· </h3>
          <div className={`graph-area flex items-end gap-2 h-48 p-4 rounded-lg overflow-x-auto ${
  darkMode ? "text-gray-200" : "text-gray-900"
}`}>

            {monthWeeks.length === 0 && (
              <p className="text-gray-500 text-sm m-auto">ì´ë²ˆ ë‹¬ ì‘ì„± ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            )}
            {monthWeeks.map((w) => (
              <div key={w} className="flex flex-col items-center justify-end flex-1">
                <div
                  className="bg-indigo-500 rounded-t"
                  style={{ height: `${(monthData[w] / maxMonthly) * 160}px`, width: "28px" }}
                ></div>
                <span className="text-xs text-gray-500 mt-1">{w}ì£¼ì°¨</span>
              </div>
            ))}
          </div>
        </section>

      </div>
    );
  })()}
</div>
{/* ğŸ—“ ì›”ê°„ ì§‘í•„ ìº˜ë¦°ë” */}
<div
id="calendar-section"
className={`${darkMode 
  ? "bg-gray-850 text-gray-200 border-gray-700" 
  : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg`}>

  <h2 className="font-semibold text-lg mb-4">ğŸ—“ ì›”ê°„ ì§‘í•„ ìº˜ë¦°ë”</h2>

  {(() => {
    const today = new Date(dateStr);
    const year = today.getFullYear();
    const month = today.getMonth(); // 0~11

    // ì›” ì²«ì§¸ ë‚  ìš”ì¼ ê³„ì‚°
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    // ğŸ§® ì¼ìë³„ ì´í•© ê³„ì‚°
    const monthData = {};
    Object.entries(store).forEach(([date, data]) => {
      const d = new Date(date);
      if (d.getFullYear() === year && d.getMonth() === month) {
        const total = Object.values(data || {}).reduce((sum, proj) => {
          if (!proj?.logs) return sum;
          return sum + proj.logs.reduce((s, l) => s + (l.diff || 0), 0);
        }, 0);
        monthData[d.getDate()] = total;
      }
    });

    // ğŸ¨ ìƒ‰ìƒ ê²°ì • í•¨ìˆ˜
    const getColor = (value) => {
      if (!value || value === 0) return "bg-gray-100 text-gray-400";
      if (value < 3000) return "bg-indigo-100 text-gray-700";
      if (value < 6000) return "bg-indigo-300 text-white";
      if (value < 9000) return "bg-green-300 text-white";
      return "bg-green-500 text-white";
    };

    // ğŸ“Š ì›”ê°„ ìš”ì•½ í†µê³„
    const total = Object.values(monthData).reduce((a, b) => a + b, 0);
    const daysWritten = Object.values(monthData).filter((v) => v > 0).length;
    const avg = daysWritten > 0 ? Math.round(total / daysWritten) : 0;
    const goal = 150000;
    const progress = Math.min(100, (total / goal) * 100);

    return (
      <div>
        {/* ì›” ë³€ê²½ ë„¤ë¹„ê²Œì´ì…˜ */}
        <div className="flex justify-between items-center mb-4">
          <button
            onClick={() => {
              const prev = new Date(year, month - 1, 1);
              setDateStr(fmtDate(prev));
            }}
            className="px-3 py-1 bg-gray-200 rounded-lg"
          >
            â—€ ì´ì „ ë‹¬
          </button>

          <h3 className="text-lg font-semibold text-indigo-700">
            {year}ë…„ {month + 1}ì›”
          </h3>

          <button
            onClick={() => {
              const next = new Date(year, month + 1, 1);
              setDateStr(fmtDate(next));
            }}
            className="px-3 py-1 bg-gray-200 rounded-lg"
          >
            ë‹¤ìŒ ë‹¬ â–¶
          </button>
        </div>

        {/* ğŸ§± ìº˜ë¦°ë” */}
        <div className="grid grid-cols-7 text-center text-sm font-medium mb-2 text-gray-600">
          <div>ì¼</div>
          <div>ì›”</div>
          <div>í™”</div>
          <div>ìˆ˜</div>
          <div>ëª©</div>
          <div>ê¸ˆ</div>
          <div>í† </div>
        </div>

       <div className="grid grid-cols-7 gap-2 text-center text-xs">
  {/* ê³µë°± ì±„ìš°ê¸° */}
  {Array.from({ length: firstDay }).map((_, i) => (
    <div key={`empty-${i}`} className="h-20"></div>
  ))}

  {/* ë‚ ì§œë³„ ì…€ */}
  {Array.from({ length: daysInMonth }).map((_, i) => {
    const day = i + 1;
    const value = monthData[day] || 0;
    const color = getColor(value);
    const key = `${year}-${String(month + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;

    const allEvents = JSON.parse(localStorage.getItem("writer_events") || "{}");
    const events = allEvents[key] || [];

    return (
      <div
  key={day}
  onClick={() => {
    const title = prompt(
      `${year}ë…„ ${month + 1}ì›” ${day}ì¼ ì¼ì • ì…ë ¥\n(ë¹ˆ ì¹¸ì´ë©´ í•´ë‹¹ ë‚ ì§œ ì¼ì • ì‚­ì œ)`
    );
    const current = JSON.parse(localStorage.getItem("writer_events") || "{}");

    if (title === null) return; // ì·¨ì†Œ
    if (title.trim() === "") {
      delete current[key];
    } else {
      current[key] = [...(current[key] || []), title.trim()];
    }

    localStorage.setItem("writer_events", JSON.stringify(current));
    window.location.reload();
  }}
  className={`calendar-day flex flex-col justify-between h-20 rounded-lg p-1 shadow-sm cursor-pointer hover:ring-2 hover:ring-indigo-400 transition ${
    darkMode
      ? `${value > 0
          ? "bg-gradient-to-b from-indigo-700 to-indigo-900 border border-indigo-600 text-white"
          : "bg-gray-800 text-gray-300 border border-gray-600 hover:bg-gray-700"}`
      : `${value > 0
          ? "bg-gradient-to-b from-indigo-100 to-indigo-300 border border-indigo-300 text-gray-900"
          : "bg-white text-gray-800 border border-gray-200 hover:bg-indigo-50"}`
  }`}
  title={`${year}-${month + 1}-${day}`}
>
  <div className="text-[11px] font-bold">{day}</div>

  {events.length > 0 && (
    <div
      className={`text-[10px] truncate mt-1 font-medium px-1 rounded ${
        darkMode ? "bg-white/20 text-indigo-100" : "bg-indigo-50 text-indigo-800"
      }`}
    >
      {events[0]}
    </div>
  )}

  <div className="text-[11px]">{value.toLocaleString()}ì</div>
</div>

    );
  })}
</div>

{/* ğŸ“‹ ì´ë²ˆ ë‹¬ ì¼ì • ìš”ì•½ */}
<div
  className={`mt-6 p-4 rounded-lg text-sm ${
    darkMode
      ? "bg-gray-800 text-gray-200 border border-gray-700"
      : "bg-indigo-50 text-gray-900 border border-gray-200"
  }`}
>
  <h3 className="font-semibold text-indigo-700 mb-2">ğŸ—’ ì´ë²ˆ ë‹¬ ì¼ì • ìš”ì•½</h3>
  {(() => {
    const allEvents = JSON.parse(localStorage.getItem("writer_events") || "{}");
    const monthEvents = Object.entries(allEvents)
      .filter(([date]) => {
        const d = new Date(date);
        return d.getFullYear() === year && d.getMonth() === month;
      })
      .sort(([a], [b]) => new Date(a) - new Date(b));

    if (monthEvents.length === 0)
      return <p className="text-gray-500 text-sm">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>;

    return (
      <ul className="divide-y divide-gray-300">
        {monthEvents.map(([date, items]) => (
          <li key={date} className="py-1 flex justify-between">
            <span className="text-indigo-600 font-medium">{date.slice(5)}</span>
            <span className="text-gray-700">{items.join(", ")}</span>
          </li>
        ))}
      </ul>
    );
  })()}
</div>



        {/* ğŸ“ˆ ì›”ê°„ ìš”ì•½ */}
        <div className={`mt-6 p-4 rounded-lg text-sm ${
  darkMode ? "bg-gray-800 text-gray-200 border border-gray-700" : "bg-indigo-50 text-gray-900 border border-gray-200"
}`}>

          <div className="flex justify-between">
            <span>ì´í•©</span>
            <span className="font-semibold text-indigo-700">
              {total.toLocaleString()}ì
            </span>
          </div>
          <div className="flex justify-between">
            <span>ì‘ì„±ì¼ ìˆ˜</span>
            <span>{daysWritten}ì¼</span>
          </div>
          <div className="flex justify-between">
            <span>ì¼í‰ê· </span>
            <span>{avg.toLocaleString()}ì</span>
          </div>
          <div className="flex justify-between">
            <span>ëª©í‘œ ë‹¬ì„±ë¥ </span>
            <span className="font-semibold text-green-600">
              {progress.toFixed(1)}%
            </span>
          </div>
        </div>
      </div>
    );
  })()}
</div>

{/* ğŸ¨ ì‘í’ˆë³„ ìš”ì•½ ì¹´ë“œ */}
<div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
 {PROJECTS.map((proj) => {
  const stats = getProjectStats(proj); // ëˆ„ì  í†µê³„ ê°€ì ¸ì˜¤ê¸°
  const progress = stats.goal > 0 ? Math.min((stats.total / stats.goal) * 100, 100) : 0;
  const remaining = stats.goal > 0 ? stats.goal - stats.total : 0;
  const avgSpeed = stats.hours > 0 ? (stats.total / stats.hours).toFixed(1) : 0;

  return (
   <div
  key={proj}
  onClick={() => setActiveProject(proj)}
  className={`${
    darkMode
      ? "bg-gray-800 text-gray-300 border-gray-600"
      : "bg-white text-gray-900 border-gray-300"
  } p-4 rounded-lg hover:shadow-md cursor-pointer transition`}
>

      <h3 className="text-lg font-semibold text-indigo-700 mb-2">{proj}</h3>
      <p className="text-sm text-gray-600 mb-2">ì‹œì‘ ê¸€ììˆ˜: {stats.startCount || 0}</p>

      {/* ì›í˜• ì§„í–‰ë¥  ë°” */}
      <div className="flex items-center mb-2">
        <div className="relative w-10 h-10 mr-3">
          <svg className="w-10 h-10" viewBox="0 0 36 36">
            <path
              className="text-gray-200"
              strokeWidth="3.5"
              stroke="currentColor"
              fill="none"
              d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831
                 a 15.9155 15.9155 0 0 1 0 -31.831"
            />
            <path
              className="text-indigo-700"
              strokeWidth="3.5"
              strokeDasharray={`${progress}, 100`}
              strokeLinecap="round"
              fill="none"
              stroke="currentColor"
              d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831
                 a 15.9155 15.9155 0 0 1 0 -31.831"
            />
          </svg>
          <span className="absolute inset-0 flex items-center justify-center text-xs font-medium text-indigo-700">
            {progress.toFixed(0)}%
          </span>
        </div>

        <div>
          <p className="text-sm font-medium text-gray-800">ì´í•©: {stats.total}ì</p>
          <p className="text-xs text-gray-500">ë‚¨ì€ ëª©í‘œì¹˜: {remaining > 0 ? remaining : 0}ì</p>
        </div>
      </div>

      <div className="text-xs text-gray-600 space-y-1">
        <p>ì„¸ì…˜: {stats.sessions}íšŒ</p>
        <p>ëˆ„ì  ì‘ì—… ì‹œê°„: {stats.hours.toFixed(1)}ì‹œê°„</p>
        <p>í‰ê·  ì†ë„: {avgSpeed}ì/ì‹œê°„</p>
      </div>
    </div>
  );
})}

{activeProject && (
  <ProjectModal
    proj={activeProject}
    onClose={() => setActiveProject(null)}
  />
)}

</div>

 {/* ğŸ’° ì¸ì„¸ ê´€ë¦¬ ì„¹ì…˜ */}
<div
  id="royalty-section"
  className={`${darkMode 
    ? "bg-gray-850 text-gray-200 border-gray-700" 
    : "bg-white text-gray-900 border-gray-200"} p-4 rounded-lg mb-6`}
>
  <h2 className="font-semibold text-lg mb-4">ğŸ’° ì¸ì„¸ ê´€ë¦¬</h2>

  {(() => {
    const [royalties, setRoyalties] = React.useState(() => {
      return JSON.parse(localStorage.getItem("writer_royalties") || "[]");
    });
const [showTable, setShowTable] = React.useState(true);

    const emptyRow = {
      date: "",
      title: "",
      type: "ìœ ì—°",
      amount: "",
      tax: "",
      net: "",
      note: "",
    };

    const [newRow, setNewRow] = React.useState(emptyRow);

    const save = (data) => {
      setRoyalties(data);
      localStorage.setItem("writer_royalties", JSON.stringify(data));
    };

    const addRow = () => {
      if (!newRow.date || !newRow.title || !newRow.amount) return alert("í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.");
      const updated = [...royalties, newRow];
      save(updated);
      setNewRow(emptyRow);
    };

    const removeRow = (idx) => {
      if (!confirm("ì •ë§ ì‚­ì œí• ê¹Œìš”?")) return;
      const updated = royalties.filter((_, i) => i !== idx);
      save(updated);
    };

    // ğŸ“… ì—°ë„, ì›”, ì‘í’ˆë³„ í•„í„°ìš© ì§‘ê³„
    const grouped = React.useMemo(() => {
      const byYear = {};
      const byMonth = {};
      const byTitle = {};
      royalties.forEach((r) => {
        const d = new Date(r.date);
        const y = d.getFullYear();
        const m = `${y}-${String(d.getMonth() + 1).padStart(2, "0")}`;

        byYear[y] = (byYear[y] || 0) + Number(r.net || 0);
        byMonth[m] = (byMonth[m] || 0) + Number(r.net || 0);
        byTitle[r.title] = (byTitle[r.title] || 0) + Number(r.net || 0);
      });
      return { byYear, byMonth, byTitle };
    }, [royalties]);

    // ğŸ“Š ê·¸ë˜í”„ìš© ë°ì´í„°
    const months = Object.entries(grouped.byMonth)
      .sort(([a], [b]) => new Date(a) - new Date(b));

    return (
      <>
        {/* ì…ë ¥ í¼ */}
        <div className="grid md:grid-cols-7 gap-2 text-sm mb-4">
          <input
            type="date"
            value={newRow.date}
            onChange={(e) => setNewRow({ ...newRow, date: e.target.value })}
            className="p-2 border rounded"
          />
          <input
            type="text"
            placeholder="ì‘í’ˆëª…"
            value={newRow.title}
            onChange={(e) => setNewRow({ ...newRow, title: e.target.value })}
            className="p-2 border rounded"
          />
          <select
            value={newRow.type}
            onChange={(e) => setNewRow({ ...newRow, type: e.target.value })}
            className="p-2 border rounded"
          >
            <option>ìœ ì—°</option>
            <option>ë‹¨í–‰</option>
            <option>ì´ˆë‹¨</option>
            <option>ê¸°íƒ€</option>
          </select>
          <input
            type="number"
            placeholder="ì •ì‚° ê¸ˆì•¡"
            value={newRow.amount}
            onChange={(e) => setNewRow({ ...newRow, amount: e.target.value })}
            className="p-2 border rounded"
          />
          <input
            type="number"
            placeholder="ê³µì œ ì„¸ì•¡"
            value={newRow.tax}
            onChange={(e) => setNewRow({ ...newRow, tax: e.target.value })}
            className="p-2 border rounded"
          />
          <input
            type="number"
            placeholder="ì‹¤ì…ê¸ˆì•¡"
            value={newRow.net}
            onChange={(e) => setNewRow({ ...newRow, net: e.target.value })}
            className="p-2 border rounded"
          />
          <input
            type="text"
            placeholder="ë¹„ê³ "
            value={newRow.note}
            onChange={(e) => setNewRow({ ...newRow, note: e.target.value })}
            className="p-2 border rounded"
          />
        </div>
        <button
          onClick={addRow}
          className="px-4 py-2 bg-indigo-500 text-white rounded-lg text-sm mb-4"
        >
          + ì¸ì„¸ ì¶”ê°€
        </button>

      {/* ğŸ“‹ ì¸ì„¸ ë‚´ì—­ */}
<div className="mt-6">
  

 {/* ğŸ“‹ ì¸ì„¸ ë‚´ì—­ í—¤ë” + ìš”ì•½ */}
<div className="flex flex-wrap justify-between items-center mb-2">
  <h3 className="font-semibold text-indigo-700">ğŸ“‹ ì¸ì„¸ ë‚´ì—­</h3>
  <button
    onClick={() => setShowTable((prev) => !prev)}
    className="text-sm text-indigo-400 hover:text-indigo-300 transition"
  >
    {showTable ? "ì ‘ê¸° â–²" : "í¼ì¹˜ê¸° â–¼"}
  </button>
</div>

{(() => {
  if (!royalties || royalties.length === 0)
    return (
      <p className="text-sm text-gray-500 mb-4">
        ì´ë²ˆ ë‹¬ ì´ ì¸ì„¸: 0ì› (ë¹„êµí•  ì§€ë‚œë‹¬ ë°ì´í„° ì—†ìŒ)
      </p>
    );

  // âœ… í˜„ì¬ ì›” / ì „ì›” ê³„ì‚°
  const now = new Date();
  const thisMonth = `${now.getFullYear()}-${String(
    now.getMonth() + 1
  ).padStart(2, "0")}`;
  const lastMonth = `${now.getFullYear()}-${String(
    now.getMonth()
  ).padStart(2, "0")}`;

  const monthSum = royalties
    .filter((r) => r.date.startsWith(thisMonth))
    .reduce((sum, r) => sum + Number(r.net || 0), 0);
  const lastMonthSum = royalties
    .filter((r) => r.date.startsWith(lastMonth))
    .reduce((sum, r) => sum + Number(r.net || 0), 0);

  // âœ… ì—°ë„ë³„ í•©ê³„ ê³„ì‚°
  const yearSum = royalties
    .filter(
      (r) => new Date(r.date).getFullYear() === new Date().getFullYear()
    )
    .reduce((sum, r) => sum + Number(r.net || 0), 0);

  const yearTax = royalties
    .filter(
      (r) => new Date(r.date).getFullYear() === new Date().getFullYear()
    )
    .reduce((sum, r) => sum + Number(r.tax || 0), 0);

  // âœ… ì¦ê°ë¥  ê³„ì‚°
  const diff =
    lastMonthSum > 0 ? ((monthSum - lastMonthSum) / lastMonthSum) * 100 : null;
  const diffText =
    diff === null
      ? "(ë¹„êµí•  ì§€ë‚œë‹¬ ë°ì´í„° ì—†ìŒ)"
      : diff > 0
      ? `â–² ${diff.toFixed(1)}% ì¦ê°€`
      : diff < 0
      ? `â–¼ ${Math.abs(diff).toFixed(1)}% ê°ì†Œ`
      : "ë³€ë™ ì—†ìŒ";

  return (
    <p className="text-sm text-indigo-300 mb-4">
      ì´ë²ˆ ë‹¬ ì´ ì¸ì„¸:{" "}
      <span className="font-semibold text-indigo-400">
        {monthSum.toLocaleString()} ì›
      </span>{" "}
      {diffText} Â·{" "}
      <span className="font-semibold text-green-400">
        ì—°ë„ ëˆ„ì : {yearSum.toLocaleString()} ì›
      </span>{" "}
      / ì„¸ì•¡ í•©ê³„:{" "}
      <span className="font-semibold text-yellow-400">
        {yearTax.toLocaleString()} ì›
      </span>
    </p>
  );
})()}




  {showTable && royalties.length > 0 ? (
    <div className="overflow-x-auto">
      <table className="min-w-full text-sm border-t border-gray-700">
        <thead>
          <tr className="text-indigo-400">
            <th className="text-left py-2">ì…ê¸ˆì¼</th>
            <th className="text-left py-2">ì‘í’ˆëª…</th>
            <th className="text-left py-2">ìœ í˜•</th>
            <th className="text-left py-2">ì •ì‚° ê¸ˆì•¡</th>
            <th className="text-left py-2">ê³µì œ ì„¸ì•¡</th>
            <th className="text-left py-2">ì‹¤ì…ê¸ˆì•¡</th>
            <th className="text-left py-2">ë¹„ê³ </th>
            <th className="text-left py-2">ìˆ˜ì •</th>

          </tr>
        </thead>
        <tbody>
          {royalties.map((r, i) => (
            <tr key={i} className="border-t border-gray-700">
              <td className="py-1">{r.date}</td>
              <td className="py-1">{r.title}</td>
              <td className="py-1">{r.type}</td>
              <td className="py-1">{Number(r.amount).toLocaleString()}</td>
              <td className="py-1">{Number(r.tax).toLocaleString()}</td>
              <td className="py-1 text-indigo-400">
                {Number(r.net).toLocaleString()}
              </td>
              <td
                className="py-1 text-red-400 cursor-pointer"
                onClick={() => removeRow(i)}

              >
                ì‚­ì œ
              </td>
              <td
  className="py-1 text-yellow-400 cursor-pointer"
  onClick={() => {
    const updated = [...royalties];
    const target = updated[i];
    const newAmount = prompt("ì •ì‚° ê¸ˆì•¡ ìˆ˜ì •", target.amount);
    const newTax = prompt("ê³µì œ ì„¸ì•¡ ìˆ˜ì •", target.tax);
    const newNet = prompt("ì‹¤ì…ê¸ˆì•¡ ìˆ˜ì •", target.net);
    const newNote = prompt("ë¹„ê³  ìˆ˜ì •", target.note);

    if (newAmount !== null) target.amount = newAmount;
    if (newTax !== null) target.tax = newTax;
    if (newNet !== null) target.net = newNet;
    if (newNote !== null) target.note = newNote;

    save(updated);
  }}
>
  ìˆ˜ì •
</td>

            </tr>
          ))}
        </tbody>
      </table>
    </div>
  ) : (
    !showTable && (
      <p className="text-sm text-gray-500 mt-1">í‘œê°€ ì ‘í˜€ ìˆìŠµë‹ˆë‹¤.</p>
    )
  )}
</div>


        

        {/* ğŸ“Š ì›”ë³„ ì¸ì„¸ ê·¸ë˜í”„ */}
<div className="mt-6">
  <h3 className="font-semibold mb-2 text-indigo-700">ğŸ“ˆ ì›”ë³„ ì¸ì„¸ ì¶”ì´</h3>
  <div className={`flex items-end gap-2 h-48 p-3 rounded-lg overflow-x-auto ${
    darkMode ? "bg-gray-800" : "bg-gray-50"
  }`}>
    {months.map(([m, val], i) => (
      <div key={i} className="flex flex-col items-center justify-end flex-1">
        <div
          className="bg-indigo-500 rounded-t w-6"
          style={{ height: `${(val / Math.max(...months.map(x => x[1]), 1)) * 160}px` }}
        />
        <span className="text-[11px] mt-1">{m}</span>
      </div>
    ))}
  </div>
</div>

{/* ğŸ“† ì—°ë„ë³„ ì¸ì„¸ í†µê³„ */}
<div className="mt-8">
  <h3 className="font-semibold mb-2 text-indigo-700">ğŸ“† ì—°ë„ë³„ ì¸ì„¸ í†µê³„</h3>
  <div className={`flex items-end gap-3 h-48 p-3 rounded-lg overflow-x-auto ${
    darkMode ? "bg-gray-800" : "bg-gray-50"
  }`}>
    {Object.entries(grouped.byYear)
      .sort(([a], [b]) => Number(a) - Number(b))
      .map(([year, total], i) => {
        const maxYearVal = Math.max(...Object.values(grouped.byYear), 1);
        return (
          <div key={i} className="flex flex-col items-center justify-end flex-1">
            <div
              className="bg-green-500 rounded-t w-8"
              style={{ height: `${(total / maxYearVal) * 160}px` }}
            />
            <span className="text-[11px] mt-1">{year}</span>
            <span className="text-[10px] text-green-300">{Number(total).toLocaleString()}</span>
          </div>
        );
      })}
  </div>
</div>

{/* ğŸ¨ ì‘í’ˆë³„ ì¸ì„¸ í†µê³„ */}
<div className="mt-8">
  <h3 className="font-semibold mb-2 text-indigo-700">ğŸ¨ ì‘í’ˆë³„ ì¸ì„¸ í†µê³„</h3>
  <div className={`grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 ${
    darkMode ? "text-gray-200" : "text-gray-800"
  }`}>
    {Object.entries(grouped.byTitle)
      .sort(([, a], [, b]) => b - a)
      .map(([title, total], i) => {
        const maxTitle = Math.max(...Object.values(grouped.byTitle), 1);
        return (
          <div key={i}
            className={`p-3 rounded-lg border ${
              darkMode ? "bg-gray-800 border-gray-700" : "bg-white border-gray-200"
            }`}>
            <div className="font-semibold truncate">{title}</div>
            <div className="text-sm text-indigo-400">{Number(total).toLocaleString()} ì›</div>
            <div
              className="mt-1 h-2 bg-indigo-500 rounded"
              style={{ width: `${(total / maxTitle) * 100}%` }}
            />
          </div>
        );
      })}
  </div>
</div>
{/* ğŸ© ìœ í˜•ë³„ ì¸ì„¸ ë¹„ì¤‘ */}
<div className="mt-10">
  <h3 className="font-semibold mb-2 text-indigo-700">ğŸ© ìœ í˜•ë³„ ì¸ì„¸ ë¹„ì¤‘</h3>

  {(() => {
    const typeTotals = {};
    royalties.forEach((r) => {
      typeTotals[r.type] = (typeTotals[r.type] || 0) + Number(r.net || 0);
    });

    const entries = Object.entries(typeTotals);
    const totalSum = entries.reduce((a, [, v]) => a + v, 0);

    if (entries.length === 0) {
      return <p className="text-sm text-gray-500">ë“±ë¡ëœ ì¸ì„¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>;
    }

    return (
      <div
        className={`flex flex-col md:flex-row items-center justify-center gap-6 p-4 rounded-lg ${
          darkMode ? "bg-gray-800 text-gray-200" : "bg-gray-50 text-gray-900"
        }`}
      >
        {/* ğŸ© ë„ë„› ì°¨íŠ¸ */}
        <svg viewBox="0 0 36 36" className="w-40 h-40 transform -rotate-90">
          {(() => {
            let cumulative = 0;
            const colors = [
              "#818CF8", // ìœ ì—°
              "#34D399", // ë‹¨í–‰
              "#FBBF24", // ì´ˆë‹¨
              "#F87171", // ê¸°íƒ€
            ];

            return entries.map(([type, val], i) => {
              const ratio = val / totalSum;
              const start = cumulative * 100;
              const end = start + ratio * 100;
              cumulative += ratio;
              return (
                <circle
                  key={i}
                  r="15.9155"
                  cx="18"
                  cy="18"
                  fill="transparent"
                  stroke={colors[i % colors.length]}
                  strokeWidth="3.5"
                  strokeDasharray={`${end - start} ${100 - (end - start)}`}
                  strokeDashoffset={-start}
                />
              );
            });
          })()}
        </svg>

        {/* ğŸ§¾ í•­ëª©ë³„ í‘œê¸° */}
        <ul className="text-sm space-y-1 text-left">
          {entries.map(([type, val], i) => {
            const percent = ((val / totalSum) * 100).toFixed(1);
            const colorClass = [
              "text-indigo-400",
              "text-green-400",
              "text-yellow-400",
              "text-red-400",
            ][i % 4];
            return (
              <li key={i} className="flex items-center gap-2">
                <span className={`w-3 h-3 rounded-full ${colorClass}`}>â—</span>
                <span className="font-medium w-12">{type}</span>
                <span className="text-gray-400">{val.toLocaleString()}ì›</span>
                <span className="ml-2 text-gray-500">({percent}%)</span>
              </li>
            );
          })}
        </ul>
      </div>
    );
  })()}
</div>

        
      </>
      
    );
    
      })()}

      
</div>




{/* ğŸ“‘ ê³„ì•½ ê´€ë¦¬ ì„¹ì…˜ */}
<div id="contract-section">
  <ContractSection darkMode={darkMode} />
</div>
{/* ì „ì²´ ë˜í¼ ë‹«ê¸° */}
</div>

);
}


  window.PlannerApp = PlannerApp;
    

    </script>
<!-- âš¡ Firebase ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ í›„ React ë Œë”ë§ (ES Modules) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDDaQFVkQMG63wI7guyMPygx9QwaokMu7I",
    authDomain: "writer-planner.firebaseapp.com",
    projectId: "writer-planner",
    storageBucket: "writer-planner.firebasestorage.app",
    messagingSenderId: "590639652717",
    appId: "1:590639652717:web:bc69fa99d82f6c5e760464"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  // ë¡œê·¸ì¸ ë²„íŠ¼
  const loginButton = document.createElement("button");
  loginButton.innerText = "ğŸ”‘ Google ë¡œê·¸ì¸";
  loginButton.className = "fixed bottom-5 right-5 bg-indigo-500 text-white px-4 py-2 rounded-lg shadow";
  document.body.appendChild(loginButton);

  // ë¡œê·¸ì¸
  loginButton.onclick = () => signInWithPopup(auth, provider);

 // âœ… ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ ë²„íŠ¼
const scrollTopButton = document.createElement("button");
scrollTopButton.innerText = "â¬†ï¸";
scrollTopButton.title = "ë§¨ ìœ„ë¡œ";
scrollTopButton.className =
  "fixed bottom-[4.5rem] right-5 bg-gray-700 text-white px-3 py-2 rounded-full shadow hover:bg-gray-600 transition";
document.body.appendChild(scrollTopButton);
scrollTopButton.onclick = () =>
  window.scrollTo({ top: 0, behavior: "smooth" });


  // ë¡œê·¸ì¸ ìƒíƒœ ê°ì‹œ
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      if (window.cloudLoaded) return;
      window.cloudLoaded = true;

      loginButton.innerText = `ğŸ‘‹ ${user.displayName}ë‹˜`;
      loginButton.disabled = true;

      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);

            if (snap.exists()) {
        const cloudData = snap.data();
        if (cloudData.planner)
          localStorage.setItem("writer_planner_store_v4", JSON.stringify(cloudData.planner));
        if (cloudData.contracts)
          localStorage.setItem("writer_contracts_v1", JSON.stringify(cloudData.contracts));
          if (cloudData.calendar)
  localStorage.setItem("calendar_tasks", JSON.stringify(cloudData.calendar));
if (cloudData.royalties)
  localStorage.setItem("writer_royalties", JSON.stringify(cloudData.royalties));

        if (cloudData.targets) // âœ… ì¶”ê°€
          localStorage.setItem("writer_targets", JSON.stringify(cloudData.targets)); // âœ… ì¶”ê°€
        console.info("â˜ï¸ í´ë¼ìš°ë“œ ë°ì´í„° ë¶ˆëŸ¬ì˜´ (planner + contracts + targets)"); // âœ… ë¬¸êµ¬ ìˆ˜ì •
      } else {
        await setDoc(ref, {});
      }

      // âœ… ìë™ ë°±ì—… (ëª©í‘œ í¬í•¨)
      setInterval(async () => {
        const planner   = JSON.parse(localStorage.getItem("writer_planner_store_v4") || "{}");
        const contracts = JSON.parse(localStorage.getItem("writer_contracts_v1") || "[]");
        const targets   = JSON.parse(localStorage.getItem("writer_targets") || "{}"); // âœ… ì¶”ê°€
        const calendar = JSON.parse(localStorage.getItem("calendar_tasks") || "{}");
        const royalties = JSON.parse(localStorage.getItem("writer_royalties") || "[]");
await setDoc(ref, { planner, contracts, targets, calendar, royalties });

        console.log("âœ… í´ë¼ìš°ë“œ ìë™ ë°±ì—… ì™„ë£Œ (planner + contracts + targets)"); // âœ… ë¬¸êµ¬ ìˆ˜ì •
      }, 30000);


      // âœ… ë¡œê·¸ì¸ í›„ì—ë§Œ React ì•± ì‹¤í–‰
if (!window.reactStarted) {
  window.reactStarted = true;

  // ğŸ”¹ Babel ë³€í™˜ì´ ëë‚¬ëŠ”ì§€ í™•ì¸ í›„ ì‹¤í–‰
  const waitForPlannerApp = setInterval(() => {
    if (window.PlannerApp) {
      clearInterval(waitForPlannerApp);
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(React.createElement(window.PlannerApp));
    }
  }, 200);
}

    } else {
      console.log("ë¡œê·¸ì¸ í•„ìš”");
    }
  });
</script>



  </body>
</html>
